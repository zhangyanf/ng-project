<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title lang="text:site_details"></title>
        <!--icon for networks-->
        <link rel="shortcut icon" href="../favicon.ico" >
        <!-- Tell the browser to be responsive to screen width -->
        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
        <!-- Bootstrap 3.3.6 -->
        <link rel="stylesheet" href="../bootstrap/css/bootstrap.min.css">

        <!-- Font Awesome -->
        <!--link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"-->
        <link rel="stylesheet" href="../plugins/Font-Awesome-3.2.1/css/font-awesome.min.css">
        <!-- iconfont -->
        <link rel="stylesheet" href="../plugins/iconfont/iconfont.css">
        <!-- Ionicons -->
        <!--link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css"-->
        <link rel="stylesheet" href="../plugins/ionicons-2.0.1/css/ionicons.min.css">
        <!-- jvectormap -->
        <link rel="stylesheet" href="../plugins/daterangepicker/daterangepicker.css">
        <link rel="stylesheet" href="../plugins/datepicker/datepicker3.css">
        <!-- Bootstrap Color Picker -->
        <link rel="stylesheet" href="../plugins/colorpicker/bootstrap-colorpicker.min.css">

         <!-- Bootstrap time Picker -->
        <link rel="stylesheet" href="../plugins/timepicker/bootstrap-timepicker.min.css">
        <!-- Select2 -->
        <link rel="stylesheet" href="../plugins/select2/select2.min.css">
        <!-- jvectormap -->
        <link rel="stylesheet" href="../plugins/jvectormap/jquery-jvectormap-1.2.2.css">
        <!-- Theme style -->
        <link rel="stylesheet" href="../dist/css/AdminLTE.min.css">
        <!-- AdminLTE Skins. Choose a skin from the css/skins
             folder instead of downloading all of them to reduce the load. -->
        <link rel="stylesheet" href="../dist/css/skins/_all-skins.min.css">
        <link rel="stylesheet" href="../plugins/multiselect/bootstrap-multiselect.css">

        <!-- DataTables -->
        <link rel="stylesheet" href="../plugins/datatables/dataTables.bootstrap.css">
        <link rel="stylesheet" href="../www/css/home.css" type="text/css" />
        <link rel="stylesheet" href="../js/css/scroll.css">
        <link rel="stylesheet" href="../plugins/jQueryUI/jquery-ui.css">
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script-->
        <!--[if lt IE 9]>
        <script src="../plugins/ie/html5shiv.min.js"></script>
        <script src="../plugins/ie/respond.min.js"></script>
        <![endif]-->

        <style>
            .example-modal .modal {
                position: relative;
                top: auto;
                bottom: auto;
                right: auto;
                left: auto;
                display: block;
                z-index: 1;
            }
            .example-modal .modal {
                background: transparent !important;
            }
            .square-box{
                margin: 1%;
                width: 98%;
                border-radius: 50%;
                box-shadow: 0px 1px 0.5px #fff;
                position: relative;
                display: block;
                padding-top: 100%;
                content: '';
            }
            .number-content{
                position: absolute;
                top: 28%;
                left: 50%;
                //font-size: 1.5vw;
                font-weight: 200;
                color: #fff;
                transform: translateX(-50%) rotate(0deg) translateY(-50%);
            }
            .item-title{
                font-weight: 200;
                margin-top: 5px;
            }
            #pcontent .content{
                overflow-y: auto;
            }
        </style>

        <script src="../plugins/jQuery/jQuery-2.2.0.min.js"></script>
        <script src="../plugins/jQuery/jquery.fileDownload.js"></script>

        <!-- Bootstrap 3.3.6 -->
        <script src="../bootstrap/js/bootstrap.min.js"></script>
        <!-- <script src="document.write("<script language='javascript' src='../plugins/multiselect/bootstrap-multiselect-en.js'></script>");"></script> -->
        <!--map -->
        <!--<script type="text/javascript" src="https://api.map.baidu.com/getscript?v=2.0&ak=5rCA4tslqZE5Ip5ew5pudaSb&services=&t="></script>-->
        <!--&lt;!&ndash;<script type="text/javascript" src="https://api.map.baidu.com/api?v=2.0&ak=5rCA4tslqZE5Ip5ew5pudaSb"></script>&ndash;&gt;-->
        <!--<script type="text/javascript" src="https://api.map.baidu.com/library/RectangleZoom/1.2/src/RectangleZoom_min.js"></script>-->
        <script type="text/javascript" src="../plugins/map/GeoUtils.js"></script>
        <script src="../plugins/jQueryUI/jquery-ui.min.js"></script>
        <!-- FastClick -->
        <script src="../plugins/fastclick/fastclick.js"></script>
        <!-- AdminLTE App -->
        <!--<script src="dist/js/app.min.js"></script>-->
        <!-- Sparkline -->
        <script src="../plugins/sparkline/jquery.sparkline.min.js"></script>
        <!-- jvectormap -->
        <script src="../plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
        <script src="../plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
        <!-- SlimScroll 1.3.0 -->
        <script src="../plugins/slimScroll/jquery.slimscroll.min.js"></script>
        <!-- FastClick -->
        <script src="../plugins/fastclick/fastclick.min.js"></script>
        <!-- DataTables -->

        <script src="../plugins/datatables/jquery.dataTables.js"></script>
        <script src="../plugins/datatables/dataTables.bootstrap.js"></script>
        <script src="../plugins/bootstrap-paginator/bootstrap-paginator.js"></script>

        <script src="../plugins/mydatepicker/WdatePicker.js"></script>
        <!-- date-range-picker -->
        <script src="../plugins/daterangepicker/moment.min.js"></script>
        <!-- date-range-picker locale -->
        <script src="../plugins/daterangepicker/locale/zh-cn.js"></script>
        <script src="../plugins/daterangepicker/daterangepicker.js"></script>

        <!-- bootstrap datepicker -->
        <script src="../plugins/datepicker/bootstrap-datepicker.js"></script>
        <!-- datepicker locales -->
        <script src="../plugins/datepicker/locales/bootstrap-datepicker.zh-CN.js"></script>
        <!-- bootstrap color picker -->
        <script src="../plugins/colorpicker/bootstrap-colorpicker.min.js"></script>
        <!-- bootstrap time picker -->
        <script src="../plugins/timepicker/bootstrap-timepicker.min.js"></script>
        <!-- Select2 -->
        <script src="../plugins/select2/select2.full.min.js"></script>

        <!--auot retrieve-->
        <script src="../js/auto.retrieve.js"></script>

        <!-- InputMask -->
        <script src="../plugins/input-mask/jquery.inputmask.js"></script>
        <script src="../plugins/input-mask/jquery.inputmask.date.extensions.js"></script>
        <script src="../plugins/input-mask/jquery.inputmask.extensions.js"></script>
        <script src="../plugins/Security/pwd_util.js"></script>
        <script src="../plugins/DateFormat/DateFormat.js"></script>
        <script src="../plugins/CryptoJS/rollups/aes.js"></script>
        <script src="../plugins/json/json2.js"></script>
        <script src="../plugins/ext/ext-base.js"></script>
        <script src="../plugins/ext/ext-all.js"></script>
        <script src="../plugins/knob/jquery.knob.js"></script>

        <script src="../js/ihtools.js"></script>
        <script src="../js/Pipe.js"></script>
        <script src="../config.js"></script>
        <script src="../plugins/ajaxfileupload/ajaxfileupload.js"></script>
        <script src="../js/jquery.validationEngine.js"></script>
        <script src="./index.js"></script>
        <script src="../permission/gates.js"></script>
        <script src="../permission/permission.js"></script>
        <script src="../js/chart-option.js"></script>
        <!--指定主模块  data-main="admin/service/app"-->
        <!--<script src="js/require.js" data-main="admin/service/app"></script>-->

        <script src="../echarts/dist/echarts.js"></script>
        <script src="../dist/js/app.min.js"></script>
        <!--<script src="plugins/jQueryUI/jquery-ui.min.js"></script>-->
        <!--<script src="js/components/dialog.js"></script>-->
        <!--插件国际化-->
        <!--分页插件-->
        <script type="text/javascript" src="../plugins/paging-tool/pagination.js"></script>

        <script>
            (function() {
                var languageType = locale.current();
                if (languageType == 1) {
                    moment.locale("en");
                    document.write('<script src="../plugins/multiselect/bootstrap-multiselect-en.js"><\/script>');
                    document.write('<script src="../echarts/dist/echarts-en.js"><\/script>');
                } else {
                    moment.locale("zh_cn");
                    document.write('<script src="../plugins/multiselect/bootstrap-multiselect-zh.js"><\/script>');
                    document.write('<script src="../echarts/dist/echarts.js"><\/script>');
                }
            })();
        </script>
        <script type="text/javascript">
            //app.js
            require.config({
                baseUrl: "../admin/service",
                paths: {
                    echarts: setting.host+'/echarts/dist',
                    "underscore": setting.host+"/js/underscore-min",
                    "dialog": setting.host+"/js/components"
                },
                shim: {
                    'siteService': {
                        deps: [],
                        exports: 'siteService'
                    },
                    'warningService': {
                        deps: [],
                        exports: 'warningService'
                    },
                    'logService': {
                        deps: [],
                        exports: 'logService'
                    },
                    'usersManagementService': {
                        deps: [],
                        exports: 'usersManagementService'
                    },
                    'rolesManagementService': {
                        deps: [],
                        exports: 'rolesManagementService'
                    },
                    'fieldMaintenanceService': {
                        deps: [],
                        exports: 'fieldMaintenanceService'
                    },
                    'reportStatisticsService': {
                        deps: [],
                        exports: 'reportStatisticsService'
                    },
                    'dataflowStatisticsService': {
                        deps: [],
                        exports: 'dataflowStatisticsService'
                    },
                    'onlineStatisticsService': {
                        deps: [],
                        exports: 'onlineStatisticsService'
                    },
                    'machinesService': {
                        deps: [],
                        exports: 'machinesService'
                    },
                    'organizationInfoService': {
                        deps: [],
                        exports: 'organizationInfoService'
                    },
                    'gatewayService': {
                        deps: [],
                        exports: 'gatewayService'
                    },
                    'scheduleService': {
                        deps: [],
                        exports: 'scheduleService'
                    },
                    'orderService': {
                        deps: [],
                        exports: 'orderService'
                    },
                    "deviceService": {
                        exports: "deviceService"
                    },
                    "underscore": {
                        exports: "_"
                    },
                    "varService": {
                        exports: "varService"
                    },
                    "hisDataService": {
                        exports: "hisDataService"
                    },
                    "dataService": {
                        exports: "dataService"
                    }
                }
            });
            var selectSiteId = getQueryParam("id");
            function clearAndDestory(){
                if (typeof contentScada != "undefined" && contentScada) {
                    destroyScada();
                    contentScada = null;
                }
                if(typeof contentInt != "undefined" && contentInt){
                    clearInterval(contentInt);
                }
                if(typeof rtTimer != "undefined" && rtTimer){
                    clearInterval(rtTimer);
                }
                if(typeof hisTimer != "undefined" && hisTimer){
                    clearInterval(hisTimer);
                }
                if(typeof alarmTimer != "undefined" && alarmTimer){
                    clearInterval(alarmTimer);
                }
            }


            var htmlIndex = 0;

            function click2url(index,obj) {
                if($('body').hasClass('sidebar-collapse') && $(".menu-open").length>0){
                    $(".menu-open").removeClass("menu-open").hide();
                }
                if(obj){
                    var $this = $(obj);
                    setTimeout(function() {
                        $(".sidebar-menu li").removeClass("active");
                        $(".treeview-menu li").removeClass("active");
                        $this.parent().parent().parent().addClass("active");
                        $this.parent().addClass("active");
                    }, 510);
                }
                clearAndDestory();


                if (index == 'overall_monitoring') {
                    repairId = '';
                    assetNo = '';
                    $("#pcontent").load("./admin/" + index + ".html",function () {
                        set_$tcontentHeight();
                    });
                } else if(index == 'siteDetail_home'){
                    repairId = '';
                    assetNo = '';
                    $("#pcontent").load("./admin/" + index + ".html",function () {
                        set_$tcontentHeight();
                        var _id=sessionStorage.getItem("_id");
                        initSiteHome(_id);
                    });
                } else if((index.split("_"))[0] =="repair") {
                    switch (index){
                        case 'repair_orderlist':
                            $("#pcontent").load("../repair/order/" + index + ".html",function () {
                                set_$tcontentHeight();
                                init_order("detail",sessionStorage.getItem("_id"));
                            });
                            break;
                        case 'repair_schedule':
                            $("#pcontent").load("../repair/schedule/" + index + ".html",function () {
                                set_$tcontentHeight();
                                init_schedule("detail");
                            });
                            break;
                        default:
                            break;
                    }
                    htmlIndex = index;
                }else {
                    $("#pcontent").load("./admin/" + index + ".html",function () {
                        set_$tcontentHeight();
                    });
                    htmlIndex = index;
                }

            }
            ;

            function goHome(page) {

                if (!$(".sidebar-menu>li:first").hasClass("active")) {
                    $(".sidebar-menu li>a:first").click();
                }
                setTimeout(function() {
                    $(".treeview-menu li").removeClass("active");
                    $("#p_site").addClass("active");
                }, 510);
                click2url(page);
            }
            var contentInt;
            var mainInt;
            //start timer
            function initTimer(handler, interval) {
                contentInt = setInterval(handler, interval);
                return contentInt;
            }
            ;
            function clearTimer(t) {
                clearInterval(t);
            }
            ;

            //初始化加载
            function init() {
                $("body").show();
                locale.render({element: "#init_body"});
                sessionStorage.setItem("_id", getQueryParam("id"));
                $("#pcontent").load("../siteDetail/admin/siteDetail_home.html",function () {
                    set_$tcontentHeight();
                    var _id=sessionStorage.getItem("_id");
                    initSiteHome(_id);
                });
                setInterval(loadSiteOverview, 5000);
                scada_perr();
            }
            //获取当前用户角色的权限信息
            function getUserPrivileges() {
                getOauth2_get_token_info(function(data) {
                    sessionStorage.setItem("accept", data.privileges.accept);
                    sessionStorage.setItem("default", data.privileges.default);
                    sessionStorage.setItem("deny", data.privileges.deny);
                    permissionFilter_pageFunc();
                    //权限过滤菜单
                    nav_permission();
                    init();
                }, this);
            }

        </script>

    </head>
    <body id="init_body" class="hold-transition skin-black-light sidebar-mini fixed" style="display:none;">
        <div class="wrapper">
            <header class="main-header" >

                <!-- Logo -->
                <a href="javascript:void(0)" class="logo">
                    <!-- mini logo for sidebar mini 50x50 pixels -->
                    <span class="logo-mini"><b>ATM</b></span>
                    <!-- logo for regular state and mobile devices -->
                    <span class="logo-lg"><b>Smart</b>ATM</span>
                </a>

                <!-- Header Navbar: style can be found in header.less -->
                <nav class="navbar navbar-static-top">
                    <!-- Sidebar toggle button-->
                    <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
                        <span class="sr-only">Toggle navigation</span>
                    </a>
                    <!-- Navbar Right Menu -->
                    <div class="navbar-custom-menu">
                        <ul class="nav navbar-nav">
                        <!-- Messages: style can be found in dropdown.less-->
                            <li class="dropdown messages-menu" style="display:none;">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                    <i class="icon-envelope"></i>
                                    <span class="label label-success" id="msg_total">4</span>
                                </a>
                                <ul class="dropdown-menu">
                                    <li class="header" id="msg_overview">您有四个消息</li>
                                    <li>
                                        <!-- inner menu: contains the actual data -->
                                        <ul class="menu" id="msg_detail">
                                            <li><!-- start message -->
                                                <a href="#">
                                                    <div class="pull-left">
                                                        <img src="../images/male.jpg" class="img-circle" alt="User Image">
                                                    </div>
                                                    <h4>
                                                        Support Team
                                                        <small><i class="fa fa-clock-o"></i> 5 mins</small>
                                                    </h4>
                                                    <p>Why not buy a new awesome theme?</p>
                                                </a>
                                            </li>
                                        </ul>
                                    </li>
                                    <li class="footer"><a href="javscript:void(0)" onclick="click2url(2)">查看</a></li>
                                </ul>
                            </li>
                            <!-- Notifications: style can be found in dropdown.less   notifications-menu -->
                            <li class="dropdown notifications-menu" data-permissionfilter="[49]">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                    <i class="icon-bell"></i>
                                    <span class="label label-warning" id="notify_total_site"></span>
                                </a>
                                <ul class="dropdown-menu" >
                                    <li class="header" id="notify_overview_site"></li>
                                    <li name="notify_li">
                                        <!-- inner menu: contains the actual data -->
                                        <ul id="notify_list_site" class="menu">

                                        </ul>
                                    </li>
                                    <li  name="notify_li" class="footer"><a href="javscript:void(0)" lang="text:view"  id="check_alarm_site" >查看</a></li>
                                </ul>
                            </li>
                            <!-- Tasks: style can be found in dropdown.less -->
                            <li class="dropdown tasks-menu" style="display:none;">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                    <i class="icon-flag"></i>
                                    <span class="label label-danger" id="task_total">9</span>
                                </a>
                                <ul class="dropdown-menu">
                                    <li class="header" id="task_overview">您有9个任务</li>
                                    <li>
                                        <!-- inner menu: contains the actual data -->
                                        <ul class="menu">
                                            <li><!-- Task item -->
                                                <a href="#">
                                                    <h3>
                                                        Design some buttons
                                                        <small class="pull-right">20%</small>
                                                    </h3>
                                                    <div class="progress xs">
                                                        <div class="progress-bar progress-bar-aqua" style="width: 20%" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">
                                                            <span class="sr-only">20% Complete</span>
                                                        </div>
                                                    </div>
                                                </a>
                                            </li>
                                            <!-- end task item -->

                                        </ul>
                                    </li>
                                    <li class="footer">
                                        <a href="#">View all tasks</a>
                                    </li>
                                </ul>
                            </li>
                            <!-- Messages: style can be found in dropdown.less-->
                            <li class="dropdown user user-menu">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                    <img id="user_img_1" src="../images/male.jpg" class="user-image" alt="User Image">
                                    <span class="hidden-xs" id="user_info_3" style="max-width: 100px;overflow: hidden;text-overflow:ellipsis;"></span>
                                </a>
                                <input type="hidden" id="user_info_1">
                                <input type="hidden" id="user_info_2">
                                <input type="hidden" id="user_phone_hidden">
                            </li>
                            <!-- Notifications: style can be found in dropdown.less   notifications-menu -->
                            <li>
                                <a href="javascript:window.opener=null;window.close();" class="dropdown-toggle">
                                    <i class="glyphicon glyphicon-remove"></i>
                                </a>
                            </li>
                        </ul>

                    </div>
                </nav>
            </header>
            <!-- Left side column. contains the logo and sidebar -->
            <aside class="main-sidebar">
                <!-- sidebar: style can be found in sidebar.less -->
                <section class="sidebar">
                    <!-- Sidebar user panel -->
                    <div class="user-panel">
                        <div class="pull-left image">
                            <!--<img id="site_img_1" src="#" class="img-circle"  alt="Site Image">-->
                            <span style="color: #aaa;" id="site_img_1"><i class="iconfont icon-atm" style="font-size: 60px;"></i></span>
                        </div>
                        <div class="pull-left info">
                            <p><i id="siteState"></i>&nbsp;
                               <p id="siteInfo_siteName" style="max-width: 100px;overflow: hidden;text-overflow:ellipsis;position: absolute;top: 7px;left: 35px;"></p>
                            </p>
                            <p id="siteInfo_address" style="max-width: 100px;overflow: hidden;text-overflow:ellipsis;font-weight: 400;"></p>
                            <p id="site_comment" style="max-width: 100px;overflow: hidden;text-overflow:ellipsis;font-weight: normal;"></p>
                        </div>
                        <div class="col-xs-12 compressor-count" style=" margin-top: 16px; margin-left: -23px;">
                            <div class="col-xs-4 text-center">
                                <div class="square-box bg-aqua" ></div>
                                <span class="number-content" id="site_assets_total2">0</span>
                                <div class="item-title text-aqua" lang="text:machine">设备</div>
                            </div>

                            <div class="col-xs-4 text-center">
                                <div class="square-box bg-yellow"></div>
                                <span class="number-content" id="site_alarm_total2">0</span>
                                <div class="item-title text-yellow" lang="text:alarm">告警</div>
                            </div>
                            <div class="col-xs-4 text-center">
                                <div class="square-box bg-red"></div>
                                <span class="number-content" id="site_alarm_unconfirmed_total2">0</span>
                                <div class="item-title text-red" lang="text:unconfirmed"></div>
                            </div>
                        </div>
                    </div>
                    <ul class="sidebar-menu">
                        <li class="active treeview" id="operation_monitoring">
                            <a href="javascript:void(0)">
                                <i class="iconfont icon-dashboard"></i>
                                <span lang="text:operation_monitoring"></span>
                            </a>
                            <ul id="p_home" class="treeview-menu">
                                <li id="p_site" class="active"><a href="javascript:void(0)" onclick="click2url('siteDetail_home',this)" ><span lang="text:dashboard"></span></a></li>
                                <!--<li id="p_webscada"><a href="javascript:void(0)" onclick="click2url('webscada')" ><span lang="text:web_scada">webscada</span></a></li>-->
                                <li id="p_reltime" style="display:none;"><a href="javascript:void(0)" onclick="click2url('real_time_data',this)" ><span lang="text:real_time_data"></span></a></li>
                                <li id="p_alarm"><a href="javascript:void(0)" onclick="click2url('historical_alarm',this)" ><span lang="text:historical_events"></span></a></li>
                                <li id="p_history" style="display:none;"><a href="javascript:void(0)" onclick="click2url('historical_trend',this)" ><span lang="text:historical_trend"></span></a></li>
                            </ul>
                        </li>
 
                        <li class="treeview"  style="display:none;">
                            <a href="#">
                                <i class="iconfont icon-device-desktop"></i>
                                <span lang="text:device_manage">设备管理</span> 
                            </a>
                            <ul class="treeview-menu">
                                    <li id="p_asset"><a href="javascript:void(0)" onclick="click2url('device_info',this)" lang="text:equipment_information">设备信息</a></li>
                                    <li id="maintain_history"><a href="javascript:void(0)" onclick="click2url('site_parts_maintenance_history',this)" lang="text:maintenance_history">维护历史</a></li>

                                    <li style="display:none;"><a href="javascript:void(0)" onclick="click2url(11,this)" lang="text:carding_machine">梳棉机</a></li>
                                </ul>
                        </li>
                        <li class="treeview" id="repair" style="display:none">
                            <a href="#">
                                <i class="iconfont icon-weixiu"></i>
                                <span lang="text:repair_manage">维修管理</span>
                            </a>
                            <ul class="treeview-menu">
                                <li id="repair_order" style="display:none;"><a href="javascript:void(0)"  onclick="click2url('repair_order',this)" lang="text:my_order">我的工单</a></li>
                                <li id="repair_orderlist"><a href="javascript:void(0)"  onclick="click2url('repair_orderlist',this)" lang="text:orderlist">工单列表</a></li>
                                <li id="repair_schedule"><a href="javascript:void(0)"  onclick="click2url('repair_schedule',this)" lang="text:repair_schedule">预防性计划</a></li>
                                <!--<li id="repair_log"><a href="javascript:void(0)"  onclick="click2url('repair_log',this)" lang="text:repair_log"></a></li>-->

                            </ul>
                        </li>
                        <li class="treeview" style="display: none;">
                            <a href="#">
                                <i class="iconfont icon-data-dictionary-config "></i>
                                <span lang="text:data_allocation">数据配置</span>
                            </a>
                            <ul class="treeview-menu">
                                <li id="data_dictionary"><a href="javascript:void(0)" onclick="click2url('data_allocation',this)" lang="text:data_dictionary">数据字典</a></li>
                                <li id="trend_chart_set"><a href="javascript:void(0)" onclick="click2url('trend_chart_set',this)" lang="text:trend_chart_set">趋势图设置</a></li>
                            </ul>
                        </li> 
                </ul>
                </section>
                <!-- /.sidebar -->
            </aside>

            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper" id="pcontent">

                <!-- /.content -->
            </div>
            <!-- /.content-wrapper -->

            <!-- Control Sidebar -->
            <aside class="control-sidebar control-sidebar-dark">
                <!-- Create the tabs -->
                <ul class="nav nav-tabs nav-justified control-sidebar-tabs">
                    <li><a href="#control-sidebar-home-tab" data-toggle="tab"><i class="fa fa-home"></i></a></li>
                    <li><a href="#control-sidebar-settings-tab" data-toggle="tab"><i class="fa fa-gears"></i></a></li>
                </ul>
                <!-- Tab panes -->
                <div class="tab-content">
                    <!-- Home tab content -->
                    <div class="tab-pane" id="control-sidebar-home-tab">
                        <h3 class="control-sidebar-heading">Recent Activity</h3>
                        <ul class="control-sidebar-menu">
                            <li>
                                <a href="javascript:void(0)">
                                    <i class="menu-icon fa fa-birthday-cake bg-red"></i>

                                    <div class="menu-info">
                                        <h4 class="control-sidebar-subheading">Langdon's Birthday</h4>

                                        <p>Will be 23 on April 24th</p>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0)">
                                    <i class="menu-icon fa fa-user bg-yellow"></i>

                                    <div class="menu-info">
                                        <h4 class="control-sidebar-subheading">Frodo Updated His Profile</h4>

                                        <p>New phone +1(800)555-1234</p>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0)">
                                    <i class="menu-icon fa fa-envelope-o bg-light-blue"></i>

                                    <div class="menu-info">
                                        <h4 class="control-sidebar-subheading">Nora Joined Mailing List</h4>

                                        <p>nora@example.com</p>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0)">
                                    <i class="menu-icon fa fa-file-code-o bg-green"></i>

                                    <div class="menu-info">
                                        <h4 class="control-sidebar-subheading">Cron Job 254 Executed</h4>

                                        <p>Execution time 5 seconds</p>
                                    </div>
                                </a>
                            </li>
                        </ul>
                        <!-- /.control-sidebar-menu -->

                        <h3 class="control-sidebar-heading">Tasks Progress</h3>
                        <ul class="control-sidebar-menu">
                            <li>
                                <a href="javascript:void(0)">
                                    <h4 class="control-sidebar-subheading">
                                        Custom Template Design
                                        <span class="label label-danger pull-right">70%</span>
                                    </h4>

                                    <div class="progress progress-xxs">
                                        <div class="progress-bar progress-bar-danger" style="width: 70%"></div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0)">
                                    <h4 class="control-sidebar-subheading">
                                        Update Resume
                                        <span class="label label-success pull-right">95%</span>
                                    </h4>

                                    <div class="progress progress-xxs">
                                        <div class="progress-bar progress-bar-success" style="width: 95%"></div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0)">
                                    <h4 class="control-sidebar-subheading">
                                        Laravel Integration
                                        <span class="label label-warning pull-right">50%</span>
                                    </h4>

                                    <div class="progress progress-xxs">
                                        <div class="progress-bar progress-bar-warning" style="width: 50%"></div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0)">
                                    <h4 class="control-sidebar-subheading">
                                        Back End Framework
                                        <span class="label label-primary pull-right">68%</span>
                                    </h4>

                                    <div class="progress progress-xxs">
                                        <div class="progress-bar progress-bar-primary" style="width: 68%"></div>
                                    </div>
                                </a>
                            </li>
                        </ul>
                        <!-- /.control-sidebar-menu -->

                    </div>
                    <!-- /.tab-pane -->

                    <!-- Settings tab content -->
                    <div class="tab-pane" id="control-sidebar-settings-tab">
                        <form method="post">
                            <h3 class="control-sidebar-heading">General Settings</h3>

                            <div class="form-group">
                                <label class="control-sidebar-subheading">
                                    Report panel usage
                                    <input type="checkbox" class="pull-right" checked>
                                </label>

                                <p>
                                    Some information about this general settings option
                                </p>
                            </div>
                            <!-- /.form-group -->

                            <div class="form-group">
                                <label class="control-sidebar-subheading">
                                    Allow mail redirect
                                    <input type="checkbox" class="pull-right" checked>
                                </label>

                                <p>
                                    Other sets of options are available
                                </p>
                            </div>
                            <!-- /.form-group -->

                            <div class="form-group">
                                <label class="control-sidebar-subheading">
                                    Expose author name in posts
                                    <input type="checkbox" class="pull-right" checked>
                                </label>

                                <p>
                                    Allow the user to show his name in blog posts
                                </p>
                            </div>
                            <!-- /.form-group -->

                            <h3 class="control-sidebar-heading">Chat Settings</h3>

                            <div class="form-group">
                                <label class="control-sidebar-subheading">
                                    Show me as online
                                    <input type="checkbox" class="pull-right" checked>
                                </label>
                            </div>
                            <!-- /.form-group -->

                            <div class="form-group">
                                <label class="control-sidebar-subheading">
                                    Turn off notifications
                                    <input type="checkbox" class="pull-right">
                                </label>
                            </div>
                            <!-- /.form-group -->

                            <div class="form-group">
                                <label class="control-sidebar-subheading">
                                    Delete chat history
                                    <a href="javascript:void(0)" class="text-red pull-right"><i class="fa fa-trash-o"></i></a>
                                </label>
                            </div>
                            <!-- /.form-group -->
                        </form>
                    </div>
                    <!-- /.tab-pane -->
                </div>
            </aside>
            <!-- /.control-sidebar -->
            <!-- Add the sidebar's background. This div must be placed
                 immediately after the control sidebar -->
            <div class="control-sidebar-bg"></div>
            <div id="modal-container-dialog-info" class="modal fade" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                            <h3 id="model_info_title">
                                提示
                            </h3>
                        </div>
                        <div class="modal-body">
                            <p id="modal_info_content"   style=" color: red; font-size: 30px" >
                            </p>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">确认</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ./wrapper -->
        <script>
            //提示信息
            function alertInfo(msg) {
                $('#modal_info_content').text(msg);
                $('#modal-container-dialog-info').modal('show');
            }
            ;
            //关闭提示
            function alertConfirm() {
                $('#modal-container-dialog-info').modal('hide');
            }

            //正在加载
            function loading() {
                $(".overlay").show();
            }
            //加载完成
            function unload() {
                $(".overlay").hide();
            }

            require(['schneiderReq', 'siteService', 'usersManagementService'], function(schneiderReq) {
                window.schneider = schneiderReq;
                // schneider.Global.init();
                getUserInfo();
                acquire_site_info();
                loadSiteOverview();
                init();
            });

            //获取当前用户信息
            function getUserInfo() {
                getAPI2_user_this({verbose: 100}, function(data) {
                    $("#user_info_1").text(data.result.name);
                    $("#user_info_2").text(data.result.email);
                    $("#user_phone_hidden").text(typeof(data.result.phone)=='undefined' ? "" :data.result.phone);
                    $("#user_info_3").text(data.result.name);
                    $("#user_info_3").attr('title', data.result.name);
                    if (data.result.photoFileId && data.result.photoFileId != undefined) {
                        // $("#user_img_1").attr("src", "/api/file/" + data.result.photoFileId + "?access_token=" + accessToken);
                        // $("#user_img_2").attr("src", "/api/file/" + data.result.photoFileId + "?access_token=" + accessToken);
                        $("#user_img_3").attr("src", "/api/file/" + data.result.photoFileId + "?access_token=" + sessionStorage.getItem("accessToken"));
                    }
                }, this);

            }
            /**
             * 子菜单绑定点击事件  选中当前选项
             * */
            $(".treeview-menu li").bind("click", function() {
                var $this = $(this);
                $(".treeview-menu li").removeClass("active");
                $this.addClass("active");
            });
            //请求现场设备数量 告警数量 未处理告警数量
            function loadSiteOverview(){
                var id = getQueryParam("id");
                getSiteOverview(id,null,true,function(data){
                    if (data.result) {
                        var unconfirmedAlarmNum = data.result.alarms.unconfirmed > 99 ? "99+" : data.result.alarms.unconfirmed;
                        var alarmNum = data.result.alarms.total>99 ? "99+" : data.result.alarms.total ;
                        var deviceNum = data.result.assets.total>99 ? "99+" : data.result.assets.total;
                        $("#site_assets_total2").text(deviceNum);
                        $("#site_alarm_total2").text(alarmNum);
                        $("#site_alarm_unconfirmed_total2").text(unconfirmedAlarmNum);
                        // $("#site_alarm_unconfirmed_total").text(data.result.alarms.unconfirmed);
                        $("#notify_overview_site").text(parseInt(unconfirmedAlarmNum) === 0 ? locale.get("has_no_affirmed_alarm") : String.format(locale.get("has_not_affirmed_alarm"), data.result.alarms.unconfirmed));
                        $("#notify_total_site").text(parseInt(unconfirmedAlarmNum) === 0 ? "":unconfirmedAlarmNum);
                        var $notifyli = ""
                        $("#notify_list_site").html("");
                        if(parseInt(alarmNum)===0){
                            $("[name=notify_li]").hide();
                        }else{
                            $.each(data.result.alarms.list, function(n, value) {
                                var levels = null;
                                var levelCss = "";
                                var levelIcon = "";
                                if (value.level == 5) {
                                    levels = locale.get({lang: "severe_alarm"});
                                    levelCss = "serious_warning";
                                    levelIcon = "iconfont icon-alarm-serious"
                                } else if (value.level == 4) {
                                    levels = locale.get("important_alarm");
                                    levelCss = "important_warning";
                                    levelIcon = "iconfont icon-alarm"
                                } else if (value.level == 3) {
                                    levels = locale.get("minor_alarm");
                                    levelCss = "minor_warning";
                                    levelIcon = "iconfont icon-alarm"
                                } else if (value.level == 2) {
                                    levels = locale.get("warn");
                                    levelCss = "caution";
                                    levelIcon = "iconfont icon-alarm"
                                } else if (value.level == 1) {
                                    levels = locale.get("remind");
                                    levelCss = "remind";
                                    levelIcon = "iconfont icon-alarm-attention"
                                }
                                var trs = '<li>' +
                                        '<a href="#" title="' + value.desc + '">' +
                                        '<h5>' + value.siteName +
                                        '   <small><i class="fa fa-clock-o"></i>' + schneider.util.dateFormat(value.createTime, "yyyy-MM-dd hh:mm:ss") + '</small>' +
                                        '</h5><span class='+ levelCss +'><i class="' +levelIcon + '"></i></span> &nbsp;' + value.desc+
                                        '</a>' +
                                        '</li>';
                                $notifyli += trs;
                            });
                            $("#notify_list_site").append($notifyli);
                        }
                    }
                },this);
            }
            //更新未确认告警总数
            function updateUnfirmedAlarms(){
                if($("#site_alarm_unconfirmed_total2").text()!="undefined" && $("#site_alarm_unconfirmed_total2").text()>0){
                    var unconfirmedAlarmNum = $("#site_alarm_unconfirmed_total2").text()-1;
                    unconfirmedAlarmNum = unconfirmedAlarmNum > 99 ? "99+" : unconfirmedAlarmNum;
                    $("#site_alarm_unconfirmed_total2").text(unconfirmedAlarmNum);
                }
            }
            //请求现场数据
            function acquire_site_info() {
                var id = getQueryParam("id");
                var params={verbose:100};

                getSiteById(id, params,function (data) {
                    if(data.result){
                        fill_siteInfo(data.result);
                    }
                },this);
            }
            //填充数据
            function fill_siteInfo(result) { 
                var name = (typeof(result.name) == "undefined") ? "" : result.name;
                var address = (typeof(result.address) == "undefined") ? "" : result.address;
                var comment = (typeof(result.comment) == "undefined") ? "" : result.comment;

                var online = result.online;
                if(online==0) {
//                    $("#site_img_1").prop("src","../images/site-info-offline.png");
                    $("#site_img_1").css("color","#aaa");
                    $("#siteState").removeClass().addClass("iconfont icon-guanji contacts-list-date");
                }else if(online==1) {
//                    $("#site_img_1").prop("src","../images/site-info-online.png");
                    $("#site_img_1").css("color","green");
                    $("#siteState").removeClass().addClass("iconfont icon-guanji text-green");
                    $("#siteInfo_siteName").addClass("text-green");
                }

                $("#siteInfo_siteName").prop("title",name).text(name);
                $("#siteInfo_address").prop("title",address).text(address);
                $("#siteInfo_comment").prop("title",comment).text(comment);
            }

            //view alarms
            $("#check_alarm_site").unbind("click").click( function( event) {

                if(!$("#operation_monitoring").hasClass("active")){
                    $("#operation_monitoring>a").click();
                }
                setTimeout(function() {
                    $(".treeview-menu li").removeClass("active");
                    $("#p_alarm").addClass("active");
                }, 510);
                $("#p_alarm a").click();

            });
            // scada
            function scada_perr() {
                // console.log( window.schneider);
                var scada_perr = 95;
                var accept=sessionStorage.getItem('accept');
                var def=sessionStorage.getItem('default');
                var deny=sessionStorage.getItem('deny');
                var accept_a = accept.split( ",");
                var deny_d = deny.split( ",");
                var marker = 0;
                if( $.inArray( scada_perr, deny) > -1) {
                    marker = 0;
                } else {
                    if( $.isArray( scada_perr, accept_a)) {
                        marker = 1;
                    } else {
                        if( def == "all") {
                            marker = 1;
                        } else if( def == "none"){
                            marker = 0;
                        } else {
                            if( parseInt( scada_perr) % 2 == 0) {
                                marker = 0;
                            } else {
                                marker = 0;
                            }
                        }
                    }
                }
                if( marker == 1) {
                    // schneider.Global.init();
                }
                /*var test = 0;
                setTimeout( function() {
                    if( test  > 3) {
                        $("#tab1").click();
                    }
                    test++;
                }, 1000);*/
                // $("#tab1").click();
            };

        </script>
        <!--多选插件bootstrap.multiselect-en.js国际化-->
        <script>
            (function() {
                var language = localStorage.getItem("language");
                if (language == "en") {
                    document.write('<script src="../plugins/multiselect/bootstrap-multiselect-en.js"><\/script>');
                } else {
                    document.write('<script src="../plugins/multiselect/bootstrap-multiselect-zh.js"><\/script>');
                }
            })();
        </script>
    </body>
</html>
