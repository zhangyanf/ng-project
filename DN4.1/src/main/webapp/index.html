<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title lang="text:smart_atm+-+home"></title>
        <!--icon for networks-->
        <link rel="shortcut icon" href="favicon.ico" >
        <!-- Tell the browser to be responsive to screen width -->
        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
        <!-- Bootstrap 3.3.6 -->
        <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">

        <link rel="stylesheet" href="plugins/Font-Awesome-3.2.1/css/font-awesome.min.css">
        <!-- iconfont -->
        <link rel="stylesheet" href="plugins/iconfont/iconfont.css">
        <link rel="stylesheet" href="plugins/ionicons-2.0.1/css/ionicons.min.css">

        <!--<link rel="stylesheet" href="plugins/daterangepicker/daterangepicker-bs3.css">-->
        <link rel="stylesheet" href="plugins/daterangepicker/daterangepicker.css">
        <link rel="stylesheet" href="plugins/datepicker/datepicker3.css">
        <!-- Bootstrap Color Picker -->
        <link rel="stylesheet" href="plugins/colorpicker/bootstrap-colorpicker.min.css">

         <!-- Bootstrap time Picker -->
        <link rel="stylesheet" href="plugins/timepicker/bootstrap-timepicker.min.css">
        <!-- Select2 -->
        <link rel="stylesheet" href="plugins/select2/select2.min.css">
        <!-- jvectormap -->
        <link rel="stylesheet" href="plugins/jvectormap/jquery-jvectormap-1.2.2.css">
        <!-- Theme style -->
        <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
        <!-- AdminLTE Skins. Choose a skin from the css/skins
             folder instead of downloading all of them to reduce the load. -->
        <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">
        <link rel="stylesheet" href="plugins/multiselect/bootstrap-multiselect.css">

        <!-- DataTables -->
        <link rel="stylesheet" href="plugins/datatables/dataTables.bootstrap.css">
        <link rel="stylesheet" href="www/css/home.css" type="text/css" />
        <link rel="stylesheet" href="plugins/jQueryUI/jquery-ui.css">
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script-->
        <!--[if lt IE 9]>
            <script src="plugins/ie/html5shiv.min.js"></script>
            <script src="plugins/ie/respond.min.js"></script>
        <![endif]-->

        <style>
            .example-modal .modal {
                position: relative;
                top: auto;
                bottom: auto;
                right: auto;
                left: auto;
                display: block;
                z-index: 1;
            }
            .example-modal .modal {
                background: transparent !important;
            }
            .sidebar-menu > li{
                display:none;
            }
            #pcontent .content{
                overflow-y: auto;
            }
            .navbar-static-top .nav-time{
                height: 50px;
                display: -webkit-flex;
                display: flex;
                -webkit-align-items: center;
                align-items: center;
            }
        </style>

        <script src="plugins/jQuery/jQuery-2.2.0.min.js"></script>
        <script src="plugins/jQuery/jquery.fileDownload.js"></script>

        <!-- Bootstrap 3.3.6 -->
        <script src="bootstrap/js/bootstrap.min.js"></script>
        <script src="bootstrap/js/bootstrap-treeview.js"></script>
        <!-- <script src="plugins/multiselect/bootstrap-multiselect.js"></script> -->
        <!--map -->
        <script type="text/javascript" src="https://api.map.baidu.com/getscript?v=2.0&ak=5rCA4tslqZE5Ip5ew5pudaSb&services=&t="></script>
        <!--<script type="text/javascript" src="https://api.map.baidu.com/api?v=2.0&ak=5rCA4tslqZE5Ip5ew5pudaSb"></script>-->
        <script type="text/javascript" src="https://api.map.baidu.com/library/RectangleZoom/1.2/src/RectangleZoom_min.js"></script>
        <!--Goolge Maps API ditu.google.cn  maps.googleapis.cn  -->
        <script type="text/javascript" src="plugins/map/GeoUtils.js"></script>
        <script src="plugins/jQueryUI/jquery-ui.min.js"></script>
        <!-- FastClick -->
        <script src="plugins/fastclick/fastclick.js"></script>
        <!-- AdminLTE App -->
        <!--<script src="dist/js/app.min.js"></script>-->
        <!-- Sparkline -->
        <script src="plugins/sparkline/jquery.sparkline.min.js"></script>
        <!-- jvectormap -->
        <script src="plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
        <script src="plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
        <!-- SlimScroll 1.3.0 -->
        <script src="plugins/slimScroll/jquery.slimscroll.min.js"></script>
        <!-- FastClick -->
        <script src="plugins/fastclick/fastclick.min.js"></script>
        <!-- DataTables -->

        <!--<script src="plugins/datatables/jquery.dataTables.js"></script>-->
        <!--<script src="plugins/datatables/dataTables.bootstrap.js"></script>-->
        <!--<script src="plugins/bootstrap-paginator/bootstrap-paginator.js"></script>-->

        <script src="plugins/mydatepicker/WdatePicker.js"></script>

        <!-- date-range-picker -->
        <script src="plugins/daterangepicker/moment.min.js"></script>
         <!-- date-range-picker locale -->
        <script src="plugins/daterangepicker/locale/zh-cn.js"></script>

        <script src="plugins/daterangepicker/daterangepicker.js"></script>

        <!-- bootstrap datepicker -->
        <script src="plugins/datepicker/bootstrap-datepicker.js"></script>
         <!-- datepicker locales -->
        <script src="plugins/datepicker/locales/bootstrap-datepicker.zh-CN.js"></script>
        <!-- bootstrap color picker -->
        <script src="plugins/colorpicker/bootstrap-colorpicker.min.js"></script>
        <!-- bootstrap time picker -->
        <script src="plugins/timepicker/bootstrap-timepicker.min.js"></script>
        <!-- Select2 -->
        <script src="plugins/select2/select2.full.min.js"></script>

        <!-- InputMask -->
        <script src="plugins/input-mask/jquery.inputmask.js"></script>
        <script src="plugins/input-mask/jquery.inputmask.date.extensions.js"></script>
        <script src="plugins/input-mask/jquery.inputmask.extensions.js"></script>
        <script src="plugins/Security/pwd_util.js"></script>
        <script src="plugins/DateFormat/DateFormat.js"></script>
        <script src="plugins/CryptoJS/rollups/aes.js"></script>
        <script src="plugins/json/json2.js"></script>
        <script src="plugins/ext/ext-base.js"></script>
        <script src="plugins/ext/ext-all.js"></script>

        <script src="js/ihtools.js"></script>
        <script src="js/Pipe.js"></script>
        <script src="config.js"></script>
        <script src="js/auto.retrieve.js"></script>
        <script src="plugins/ajaxfileupload/ajaxfileupload.js"></script>
        <script src="js/jquery.validationEngine.js"></script>
        <script src="permission/gates.js"></script>
        <script src="index.js"></script>
        <script src="permission/permission.js"></script>
        <script src="js/chart-option.js"></script>
        <!--<script src="js/fix-head-tools.js"></script>-->
        <!--指定主模块  data-main="admin/service/app"-->
        <!--<script src="js/require.js" data-main="admin/service/app"></script>-->

        <!-- <script src="echarts/dist/echarts.js"></script> -->
        <script src="dist/js/app.min.js"></script>
        <!--<script src="plugins/jQueryUI/jquery-ui.min.js"></script>-->
        <!--<script src="js/components/dialog.js"></script>-->
        <!--插件国际化-->
        <!--分页插件-->
        <script type="text/javascript" src="plugins/paging-tool/pagination.js"></script>

        <script>
            (function() {
                var languageType = locale.current();
                if (languageType == 1) {
                    moment.locale("en");
                    document.write('<script src="plugins/multiselect/bootstrap-multiselect-en.js"><\/script>');
                    document.write('<script src="echarts/dist/echarts-en.js"><\/script>');
                    document.write('<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBXcMfyBoH4cBbKOBaGhE_1OtaPqp07Wj8&libraries=places"><\/script>');

                } else {
                    moment.locale("zh_cn");
                    document.write('<script src="plugins/multiselect/bootstrap-multiselect-zh.js"><\/script>');
                    document.write('<script src="echarts/dist/echarts.js"><\/script>');
                }
            })();
        </script>

        <script type="text/javascript">
            //app.js
            require.config({
                baseUrl: "./admin/service",
                paths: {
                    echarts: setting.host+'/echarts/dist',
                    "underscore": setting.host+"/js/underscore-min",
                    "dialog": setting.host+"/js/components"
                },
                shim: {
                    'siteService': {
                        deps: [],
                        exports: 'siteService'
                    },
                    'warningService': {
                        deps: [],
                        exports: 'warningService'
                    },
                    'logService': {
                        deps: [],
                        exports: 'logService'
                    },
                    'usersManagementService': {
                        deps: [],
                        exports: 'usersManagementService'
                    },
                    'rolesManagementService': {
                        deps: [],
                        exports: 'rolesManagementService'
                    },
                    'fieldMaintenanceService': {
                        deps: [],
                        exports: 'fieldMaintenanceService'
                    },
                    'reportStatisticsService': {
                        deps: [],
                        exports: 'reportStatisticsService'
                    },
                    'dataflowStatisticsService': {
                        deps: [],
                        exports: 'dataflowStatisticsService'
                    },
                    'onlineStatisticsService': {
                        deps: [],
                        exports: 'onlineStatisticsService'
                    },
                    'machinesService': {
                        deps: [],
                        exports: 'machinesService'
                    },
                    'organizationInfoService': {
                        deps: [],
                        exports: 'organizationInfoService'
                    },
                    'gatewayService': {
                        deps: [],
                        exports: 'gatewayService'
                    },
                    'scheduleService': {
                        deps: [],
                        exports: 'scheduleService'
                    },
                    'orderService': {
                        deps: [],
                        exports: 'orderService'
                    },
                    "underscore": {
                        exports: "_"
                    },
                    "deviceService": {
                        exports: "deviceService"
                    },
                    "partService": {
                        exports: "partService"
                    }
                }
            });
//            var schneider = null;
            require(['schneiderReq', 'siteService', 'usersManagementService'], function(schneiderReq) {
                window.schneider = schneiderReq;
                // schneider.Global.init();
                getUserInfo();
                loadOverview();
                getUserPrivileges();
                $(document).click(function (event) {
                    if($("#save_self").is(":visible")){
                        $("#user_dropdown").parent().find(".dropdown-menu").hide();
                        $("#edit_self").show();
                        $("#save_self").hide();
                        getUserInfo();
                    }else if($("#edit_self").is(":visible")){
                        $("#user_dropdown").parent().find(".dropdown-menu").hide();
                    }
                });
                $('#user_dropdown,.dropdown-menu').click(function (event) {event.stopPropagation();});
                /**
                 * 显示用户信息下拉框
                 */
                $("#user_dropdown").bind("click", function() {
                    var $this = $(this);
                    var $dropdown = $this.parent().find(".dropdown-menu");
                    if($dropdown.is(":visible")){
                        $this.parent().find(".dropdown-menu").hide();
                    }else{
                        $this.parent().find(".dropdown-menu").show();
                    }
                });
            });
            function loadOverview() {
                getOverview(null, true, function(data) {
                    if (data.result) {
                        var alarmNum = data.result.alarms.unconfirmed;
                        siteTotal = data.result.sites.total;
                        var deviceNum = data.result.assets.total;
                        $("#sites_total").text(parseInt(siteTotal) > 99 ? '99+' : (parseInt(siteTotal) === 0 ? "" : siteTotal));
                        $("#devices_total").text(parseInt(deviceNum) > 99 ? '99+' : (parseInt(deviceNum) === 0 ? "" : deviceNum));
                        $("#alert_count").text(parseInt(alarmNum) > 99 ? '99+' : (parseInt(alarmNum) === 0 ? "" : alarmNum));
                        $("#notify_total").text(parseInt(alarmNum) > 99 ? '99+' : (parseInt(alarmNum) === 0 ? "" : alarmNum));
                        $("#notify_overview").text(parseInt(alarmNum) === 0 ? locale.get("has_no_affirmed_alarm") : String.format(locale.get("has_not_affirmed_alarm"), alarmNum));
                        var $notifyli = ""
                        $("#notify_list").html("");
                        $("#alarm_unconfirmed_total").text(alarmNum);
                        if(parseInt(alarmNum)===0){
                            $("[name=notify_li]").hide();
                        }else{
                            $.each(data.result.alarms.list, function(n, value) {
                                var levels = null;
                                var levelCss = "";
                                var levelIcon = "";
                                if (value.level == 5) {
                                    levels = locale.get({lang: "severe_alarm"});
                                    levelCss = "serious_warning";
                                    levelIcon = "iconfont icon-alarm-serious"
                                } else if (value.level == 4) {
                                    levels = locale.get("important_alarm");
                                    levelCss = "important_warning";
                                    levelIcon = "iconfont icon-alarm"
                                } else if (value.level == 3) {
                                    levels = locale.get("minor_alarm");
                                    levelCss = "minor_warning";
                                    levelIcon = "iconfont icon-alarm"
                                } else if (value.level == 2) {
                                    levels = locale.get("warn");
                                    levelCss = "caution";
                                    levelIcon = "iconfont icon-alarm"
                                } else if (value.level == 1) {
                                    levels = locale.get("remind");
                                    levelCss = "remind";
                                    levelIcon = "iconfont icon-alarm-attention"
                                }
                                var trs = '<li>' +
                                        '<a href="#" title="' + value.desc + '">' +
                                        '<h5>' + value.siteName +
                                        '   <small><i class="fa fa-clock-o"></i>' + schneider.util.dateFormat(value.createTime, "yyyy-MM-dd hh:mm:ss") + '</small>' +
                                        '</h5><span class='+ levelCss +'><i class="' +levelIcon + '"></i></span> &nbsp;' + value.desc+
                                        '</a>' +
                                        '</li>';
                                $notifyli += trs;
                            });
                            $("#notify_list").append($notifyli);
                        }
                    }

                }, this);
            }
            var htmlIndex = 0;
            var siteTotal = 0;
            var params = {};
            function click2url(index,obj) {
                //清理多余的日期插件
                $(".daterangepicker.dropdown-menu.show-calendar").remove();

                if ($('body').hasClass('sidebar-collapse') && $(".menu-open").length > 0) {
                    $(".menu-open").removeClass("menu-open").hide();
                } else if (index == "home") {
                    $(".menu-open").removeClass("menu-open").hide();
                }
                if (obj) {
                    var $this = $(obj);
                    setTimeout(function () {
                        $(".sidebar-menu li").removeClass("active");
                        $(".treeview-menu li").removeClass("active");
                        $this.parent().parent().parent().addClass("active");
                        $this.parent().addClass("active");
                    }, 510);
                }

                clearAndDestory();

                if (index == 'overall_monitoring') {
                    repairId = '';
                    assetNo = '';
                    $("#pcontent").load("admin/" + index + ".html", function () {
                        set_$tcontentHeight();
                    });
                } else if ((index.split("_"))[0] == "repair") {
                    switch (index) {
                        case 'repair_order':
                            $("#pcontent").load("repair/order/" + index + ".html", function () {
                                set_$tcontentHeight();
                            });
                            break;
                        case 'repair_orderlist':
                            $("#pcontent").load("repair/order/" + index + ".html", function () {
                                set_$tcontentHeight();
                                init_order("home");
                            });
                            break;
                        case 'repair_schedule':
                            $("#pcontent").load("repair/schedule/" + index + ".html", function () {
                                set_$tcontentHeight();
                                init_schedule("home");
                            });
                            break;
                        case 'repair_report_performance':
                            $("#pcontent").load("repair/report/performance_statistics.html", function () {
                                set_$tcontentHeight();
                            });
                            break;
                        case 'repair_report_workload':
                            $("#pcontent").load("repair/report/workload_statistics.html", function () {
                                set_$tcontentHeight();
                            });
                            break;
                        case 'repair_log':
                            $("#pcontent").load("repair/log/" + index + ".html", function () {
                                set_$tcontentHeight();
                            });
                            break;
                        default:
                            break;
                    }
                    htmlIndex = index;
                } else if (index == "config_siteList") {
                    $("#pcontent").load("admin/site/" + index + ".html", function () {
                        set_$tcontentHeight();
                    });
                    htmlIndex = index;
                } else {
                    $("#pcontent").load("admin/" + index + ".html", function () {
                        set_$tcontentHeight();
                    });
                    htmlIndex = index;
                }
            }
            ;
            function goHome(page) {
                if(!$(".sidebar-menu>li:first").hasClass("active")){
                    $(".sidebar-menu li>a:first").click();
                }
                setTimeout(function() {
                    $(".treeview-menu li").removeClass("active");
                    $("#firstpage_map").addClass("active");
                }, 510);
                click2url(page);
            }
            var contentInt;
            var mainInt;
            var selectSiteId = "";
            //start timer
            function initTimer(handler, interval) {
                contentInt = setInterval(handler, interval);
                return contentInt;
            }
            ;
            function clearTimer(t) {
                clearInterval(t);
            }
            ;
            //清除定时器，组态
            function clearAndDestory(){
                if (typeof contentScada != "undefined" && contentScada) {
                    destroyScada();
                    contentScada = null;
                }
                if(typeof contentInt != "undefined" && contentInt){
                    clearInterval(contentInt);
                }
                if(typeof rtTimer != "undefined" && rtTimer){
                    clearInterval(rtTimer);
                }
                if(typeof hisTimer != "undefined" && hisTimer){
                    clearInterval(hisTimer);
                }
                if(typeof alarmTimer != "undefined" && alarmTimer){
                    clearInterval(alarmTimer);
                }
            }
            function alertInfo(msg) {
                $('#main-modal-body').text(msg);
                $('#main-modal').modal('show');
            }
            ;
            locale.render({element: "#init_body"});

            //初始化加载
            function init() {

                $("body").show();
                $("#pcontent").load("admin/home.html",function () {
                    set_$tcontentHeight();
                });

                setInterval(loadOverview, 5000);
                scada_perr();
                var date=new Date();
                var offset_ts=date.getTimezoneOffset();
                var offset_zone=-1*(offset_ts/60);
                $("#nav_utc_time_select > option[value='"+offset_zone+"']").prop("selected",true);
                window.nav_utc_time=setInterval(function () {
                    nav_utctime(offset_zone);
                },1000);
                //切换时区是改变时区时间的时钟
                $("#nav_utc_time_select").off().on('change',function (ent) {
                    clearInterval(window.nav_utc_time);
                    $("#nav_utc_time_text").fadeOut(1000);
                    $("#nav_utc_time_text").text("");
                    $("#nav_utc_time_text").fadeIn("slow","linear");
                    var nav_zone=$("#nav_utc_time_select").val();
                    window.nav_utc_time=setInterval(function () {
                        nav_utctime(nav_zone);
                    },1000);
                });
            }
            //根据不同时区显示时钟
            function nav_utctime(zone) {
                var date=new Date();
                var utcTime = parseInt(date.getTime()) + parseInt(date.getTimezoneOffset() * 60000);
                $("#nav_utc_time_text").text(schneider.util.dateFormat(utcTime + 3600000 * zone, "yyyy-MM-dd hh:mm:ss"));
            }

            //自定义修改密码表单验证
            validator.render("#model_changePWd_form", {
                promptPosition: "inline",
                scroll: false
            });
            //自定义修改密码表单验证
            validator.render("#dropdown_user_form", {
                promptPosition: "topLeft",
                scroll: false
            });
        </script>

    </head>
    <body id="init_body" class="hold-transition skin-black-light sidebar-mini fixed"  onunload="closeNews();" style="display:none;">
        <div class="wrapper">

            <header class="main-header" >

                <!-- Logo -->
                <a href="index.html" class="logo">
                    <!-- mini logo for sidebar mini 50x50 pixels -->
                    <span class="logo-mini"><b>ATM</b></span>
                    <!-- logo for regular state and mobile devices -->
                    <span class="logo-lg"><b>Smart</b>ATM</span>
                </a>

                <!-- Header Navbar: style can be found in header.less -->
                <nav class="navbar navbar-static-top">
                    <!-- Sidebar toggle button-->
                    <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
                        <span class="sr-only">Toggle navigation</span>
                    </a>
                    <!--timer-->
                    <div class="navbar-nav nav-time">
                        <div class="form-inline">
                            <select id="nav_utc_time_select" class="form-control" style="border-radius: 5px;">
                                <option value="0">UTC</option>
                                <option value="1">UTC+1</option>
                                <option value="2">UTC+2</option>
                                <option value="3">UTC+3</option>
                                <option value="4">UTC+4</option>
                                <option value="5">UTC+5</option>
                                <option value="6">UTC+6</option>
                                <option value="7">UTC+7</option>
                                <option value="8">UTC+8</option>
                                <option value="9">UTC+9</option>
                                <option value="10">UTC+10</option>
                                <option value="11">UTC+11</option>
                                <option value="12">UTC+12</option>
                                <option value="-12">UTC-12</option>
                                <option value="-11">UTC-11</option>
                                <option value="-10">UTC-10</option>
                                <option value="-9">UTC-9</option>
                                <option value="-8">UTC-8</option>
                                <option value="-7">UTC-7</option>
                                <option value="-6">UTC-6</option>
                                <option value="-5">UTC-5</option>
                                <option value="-4">UTC-4</option>
                                <option value="-3">UTC-3</option>
                                <option value="-2">UTC-2</option>
                                <option value="-1">UTC-1</option>
                            </select>
                            <span id="nav_utc_time_text" style="font-size: 120%;color: #666;"></span>
                        </div>
                    </div>
                    <!--timer-->
                    <!-- Navbar Right Menu -->
                    <div class="navbar-custom-menu">
                        <ul class="nav navbar-nav">
                            <!-- Messages: style can be found in dropdown.less-->
                            <li class="dropdown messages-menu" style="display:none;">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                    <i class="icon-envelope"></i>
                                    <span class="label label-success" id="msg_total">4</span>
                                </a>
                                <ul class="dropdown-menu">
                                    <li class="header" id="msg_overview"></li>
                                    <li>
                                        <!-- inner menu: contains the actual data -->
                                        <ul class="menu" id="msg_detail">
                                            <li><!-- start message -->
                                                <a href="#">
                                                    <div class="pull-left">
                                                        <img src="images/male.jpg" class="img-circle" alt="User Image">
                                                    </div>
                                                    <h4>
                                                        Support Team
                                                        <small><i class="fa fa-clock-o"></i> 5 mins</small>
                                                    </h4>
                                                    <p>Why not buy a new awesome theme?</p>
                                                </a>
                                            </li>
                                        </ul>
                                    </li>
                                    <li class="footer"><a href="javscript:void(0)" onclick="click2url(2)"></a></li>
                                </ul>
                            </li>
                            <!-- Notifications: style can be found in dropdown.less   notifications-menu -->
                            <li class="dropdown notifications-menu" data-permissionfilter="[49]">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                    <i class="icon-bell"></i>
                                    <span class="label label-warning" id="notify_total"></span>
                                </a>
                                <ul class="dropdown-menu" >
                                    <li class="header" id="notify_overview"></li>
                                    <li name="notify_li">
                                        <!-- inner menu: contains the actual data -->
                                        <ul id="notify_list" class="menu">

                                        </ul>
                                    </li>
                                    <li  name="notify_li" class="footer"><a href="javscript:void(0)" lang="text:view"  id="check_alarm" ></a></li>
                                </ul>
                            </li>
                            <!-- Tasks: style can be found in dropdown.less -->
                            <li class="dropdown tasks-menu" style="display:none;">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                    <i class="icon-flag"></i>
                                    <span class="label label-danger" id="task_total">9</span>
                                </a>
                                <ul class="dropdown-menu">
                                    <li class="header" id="task_overview"></li>
                                    <li>
                                        <!-- inner menu: contains the actual data -->
                                        <ul class="menu">
                                            <li><!-- Task item -->
                                                <a href="#">
                                                    <h3>
                                                        Design some buttons
                                                        <small class="pull-right">20%</small>
                                                    </h3>
                                                    <div class="progress xs">
                                                        <div class="progress-bar progress-bar-aqua" style="width: 20%" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">
                                                            <span class="sr-only">20% Complete</span>
                                                        </div>
                                                    </div>
                                                </a>
                                            </li>
                                            <!-- end task item -->

                                        </ul>
                                    </li>
                                    <li class="footer">
                                        <a href="#">View all tasks</a>
                                    </li>
                                </ul>
                            </li>
                            <!-- User Account: style can be found in dropdown.less -->
                            <li class="dropdown user user-menu">

                                <a id="user_dropdown" href="#" class="dropdown-toggle" >
                                    <img id="user_img_1" src="images/male.jpg" class="user-image" alt="User Image">
                                    <span class="hidden-xs" id="user_info_1" style="max-width: 100px;overflow: hidden;text-overflow:ellipsis;"></span>
                                    <input type="hidden" id="user_id">
                                </a>
                                <ul class="dropdown-menu">
                                    <!-- User image -->
                                    <li class="user-header">
                                        <img id="user_img_2" src="images/male.jpg" class="img-circle" alt="User Image">

                                        <p id="user_info_2">
                                        </p>
                                        <p id="user_rolename"> </p>
                                    </li>
                                    <!-- Menu Body -->
                                    <li class="user-body">
                                        <form id="dropdown_user_form" >
                                        <div class="row">
                                            <div class="col-xs-12 text-center">
                                                <div class="col-xs-6 text-right">
                                                    <small lang="text:username+："></small>
                                                </div>
                                                <div class="col-xs-6 text-left" style=" padding: 0px;">
                                                    <input type="hidden" id="user_name_hidden">
                                                    <small id="user_name">

                                                    </small>
                                                </div>
                                            </div>
                                            <div class="col-xs-12 text-center">
                                                <div class="col-xs-6 text-right">
                                                    <small lang="text:phone+："></small>
                                                </div>
                                                <div class="col-xs-6 text-left" style=" padding: 0px;">
                                                    <input type="hidden" id="user_phone_hidden">
                                                    <small id="user_phone"></small>
                                                </div>
                                            </div>
                                            <div class="col-xs-12 text-center">
                                                <div class="col-xs-6 text-right">
                                                    <small lang="text:last_login+："></small>
                                                </div>
                                                <div class="text-left">
                                                    <small id="last_login_ts"></small>
                                                </div>
                                            </div>
                                            <div class="col-xs-12 text-center">
                                                <div class="col-xs-6 text-right">
                                                    <small lang="text:last_logout+："></small>
                                                </div>
                                                <div class="text-left">
                                                    <small id="last_logout_ts"></small>
                                                </div>
                                            </div>
                                            <div class="col-xs-12 text-center">
                                                <div class="col-xs-6 text-right">
                                                    <small lang="text:last_login_ip+："></small>
                                                </div>
                                                <div class="text-left">
                                                    <small id="last_login_ip"></small>
                                                </div>
                                            </div>
                                        </div>
                                        </form>
                                    </li>
                                    <!-- Menu Footer-->
                                    <li class="user-footer" style="padding:10px 0px;">
                                        <div class="text-center">
                                            <!--<a href="#" class="btn btn-default btn-flat">我的资料</a>-->
                                            <a href="javascript:;" class="btn btn-default icon-key" style="padding: 6px;" lang="title:changepwd" onclick="changePassword_self()"> <span lang="text:change_pwd"></span></a>
                                            <a href="javascript:;" id="edit_self" class="btn btn-default  icon-edit" style="padding: 6px;" lang="title:edit" onclick="edit_self()"> <span lang="text:edit"></span></a>
                                            <a href="javascript:;" id="save_self" style="display: none; padding: 6px;" class="btn btn-default  icon-save" lang="title:save" onclick="save_self()"> <span lang="text:save"></span></a>
                                            <a href="javascript:;" class="btn btn-default  icon-signout" style="padding: 6px;" lang="title:logout" onclick="logout()"> <span lang="text:logout"></span></a>
                                        </div>
                                    </li>
                                </ul>
                            </li>

                        </ul>
                    </div>

                </nav>
            </header>
            <!-- Left side column. contains the logo and sidebar -->
            <aside class="main-sidebar">
                <!-- sidebar: style can be found in sidebar.less -->
                <section class="sidebar">
                    <!-- Sidebar user panel -->
                    <div class="user-panel" >
                        <div class="pull-left image">
                            <img id="user_img_3" src="images/male.jpg" class="img-circle" alt="User Image">
                        </div>
                        <div class="pull-left info">
                            <p id="user_info_3" style="max-width: 100px;overflow: hidden;text-overflow:ellipsis;" data-toggle='tooltip' title=""></p>
                            <a href="#"><i class="icon-circle text-success text-green"></i> <span lang="text:online"></span></a>
                        </div>
                    </div>
                    <!-- search form -->
                    <!--form action="#" method="get" class="sidebar-form">
                      <div class="input-group">
                        <input type="text" name="q" class="form-control" placeholder="Search...">
                            <span class="input-group-btn">
                              <button type="submit" name="search" id="search-btn" class="btn btn-flat"><i class="fa fa-search"></i>
                              </button>
                            </span>
                      </div>
                    </form-->
                    <!-- /.search form -->
                    <!-- sidebar menu: : style can be found in sidebar.less -->
                    <ul class="sidebar-menu">
                        <li class="active treeview" id="firstpage">
                            <a href="javascript:void(0)" onclick="click2url('home',this)"  id="firstpage_map" >
                                <i class="iconfont icon-home"></i> <span lang="text:home"></span>
                                <span class="label label-primary pull-right" id="sites_total"></span>
                            </a>
                            <!--<ul class="treeview-menu">-->
                                <!--<li id="firstpage_map"  ><a href="javascript:void(0)" onclick="click2url('home',this)" ><span lang="text:map"></span></a></li>-->
                                <!--<li id="firstpage_site"><a href="javascript:void(0)" onclick="click2url('report_site',this)" lang="text:site"></a></li>-->
                            <!--</ul>-->
                        </li>
                         

                        <li class="treeview" id="alarmList" style="display:none;">
                            <a href="#">
                                <i class="iconfont icon-notice"></i>
                                <span lang="text:notice"></span>
                                <span style="display:none;" class="label label-warning pull-right" id="alert_count"></span>
                            </a>
                            <ul class="treeview-menu">
                                <li  style="display:none;"><a href="javascript:void(0)" onclick="click2url(20,this)" lang="text:failure_and_safety_alarm"><i class="icon-circle"></i></a></li>
                                <li id="alarmList_alarmManage"><a href="javascript:void(0)"  onclick="click2url('alarm_list',this)" lang="text:alarm"></a></li>
                                <li id="notice_logManage"><a href="javascript:void(0)"  onclick="click2url('log_list',this)" lang="text:log"></a></li>
                            </ul>
                        </li>
                        <li class="treeview" id="repair" style="display:none;">
                            <a href="#">
                                <i class="iconfont icon-weixiu"></i>
                                <span lang="text:repair_manage"> </span>
                            </a>
                            <ul class="treeview-menu">
                                <li id="repair_order" style="display:none;"><a href="javascript:void(0)"  onclick="click2url('repair_order',this)" lang="text:my_order"> </a></li>
                                <li id="repair_orderlist"><a href="javascript:void(0)"  onclick="click2url('repair_orderlist',this)" lang="text:orderlist"> </a></li>
                                <li id="repair_schedule"><a href="javascript:void(0)"  onclick="click2url('repair_schedule',this)" lang="text:repair_schedule"> </a></li>
                                <!--<li id="repair_log"><a href="javascript:void(0)"  onclick="click2url('repair_log',this)" lang="text:repair_log"></a></li>-->

                            </ul>
                        </li>
                        <li class="treeview" id="reportList"  style="display:none;">
                            <a href="#">
                                <i class="iconfont icon-report"></i>
                                <span lang="text:report"> </span>
                                <!--span class="label label-primary pull-right" id="alert_count">12</span-->
                            </a>
                            <ul class="treeview-menu">
                                <li id="repair_report_performance" style="display: none;"><a href="javascript:void(0)"  onclick="click2url('repair_report_performance',this)" lang="text:repair_report_performance"> </a></li>
                                <li id="repair_report_workload" style="display: none;"><a href="javascript:void(0)"  onclick="click2url('repair_report_workload',this)" lang="text:repair_report_workload"> </a></li>
                                <li id="grageway_report"><a href="javascript:void(0)"  onclick="click2url('report_gateway',this)" lang="text:report_gateway"> </a></li>
                                <li id="reportList_traff" style="display: none;"><a href="javascript:void(0)" onclick="click2url('report_traffic_statistics',this)" lang="text:traffic_statistics"></a></li>
                                <li id="reportList_online"  style="display: none;"><a href="javascript:void(0)" onclick="click2url('report_online_statistics',this)" lang="text:online_statistics"></a></li>
                            </ul>
                        </li>
                        <li class="treeview" id="configList"  style="display:none;">
                            <a href="#">
                                <i class="iconfont icon-config"></i>
                                <span lang="text:site_management">  </span>
                                <!--span class="label label-primary pull-right" id="alert_count">12</span-->
                            </a>
                            <ul class="treeview-menu">
                                <li id="configList_site"><a href="javascript:void(0)" onclick="click2url('config_siteList',this)" lang="text:site"></a></li>
                                <li id="configList_gateway" style="display: none;"><a href="javascript:void(0)" onclick="click2url('config_gateway',this)" lang="text:gateway"></a></li>
                                <!--<li id="configList_controller"><a href="javascript:void(0)" onclick="click2url('config_controller',this)" lang="text:controller"><i class="icon-circle"></i>控制器</a></li>-->

                                <!--<li><a href="javascript:void(0)" onclick="click2url(29)" lang="text:organ_info"><i class="icon-circle"></i>机构信息</a></li>-->
                                <!--<li><a href="javascript:void(0)" onclick="click2url(25)" lang="text:visit_statistics"><i class="icon-circle"></i>访问统计</a></li>-->
                            </ul>
                        </li>
                        <li class="treeview" id="systemList"  style="display:none;">
                            <a href="#">
                                <i class="iconfont icon-system-settings"></i>
                                <span lang="text:system"> </span>
                                <!--span class="label label-primary pull-right" id="alert_count">12</span-->
                            </a>
                            <ul class="treeview-menu">
                                <li id="systemList_user"><a href="javascript:void(0)" onclick="click2url('system_user',this)" lang="text:user"></a></li>
                                <li id="systemList_role"><a href="javascript:void(0)" onclick="click2url('system_role',this)" lang="text:role"></a></li>
                                <li id="systemList_field_maintenance"><a href="javascript:void(0)" onclick="click2url('system_field_maintenance',this)" lang="text:field_maintenance"> </a></li>
                                <!--<li><a href="javascript:void(0)" onclick="click2url(29)" lang="text:organ_info"><i class="icon-circle"></i>机构信息</a></li>-->
                                <!--<li><a href="javascript:void(0)" onclick="click2url(25)" lang="text:visit_statistics"><i class="icon-circle"></i>访问统计</a></li>-->
                            </ul>
                        </li>
                        <!--新添加了下载菜单-->
                        <li class="treeview" id="dowloadList"  style="display:none;">
                            <a href="#">
                                <i class="iconfont icon-cloud-download"></i>
                                <span lang="text:download"> </span>
                                <!--span class="label label-primary pull-right" id="alert_count">12</span-->
                            </a>
                            <ul class="treeview-menu">
                                <li id="dowloadList_devicetouch"><a href="javascript:void(0)" onclick="click2url('download/devicetouch',this)" lang="text:devicetouch"></a></li>
                                <li id="dowloadList_alarmApp"><a href="javascript:void(0)" onclick="click2url('download/alarmApp',this)" lang="text:device_cloud_app"></a></li>
                            </ul>
                        </li>
                    </ul>
                </section>
                <!-- /.sidebar -->
            </aside>

            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper" id="pcontent">

                <!-- /.content -->
            </div>
            <!-- /.content-wrapper -->

            <!-- Control Sidebar -->
            <aside class="control-sidebar control-sidebar-dark">
                <!-- Create the tabs -->
                <ul class="nav nav-tabs nav-justified control-sidebar-tabs">
                    <li><a href="#control-sidebar-home-tab" data-toggle="tab"><i class="fa fa-home"></i></a></li>
                    <li><a href="#control-sidebar-settings-tab" data-toggle="tab"><i class="fa fa-gears"></i></a></li>
                </ul>
                <!-- Tab panes -->
                <div class="tab-content">
                    <!-- Home tab content -->
                    <div class="tab-pane" id="control-sidebar-home-tab">
                        <h3 class="control-sidebar-heading">Recent Activity</h3>
                        <ul class="control-sidebar-menu">
                            <li>
                                <a href="javascript:void(0)">
                                    <i class="menu-icon fa fa-birthday-cake bg-red"></i>

                                    <div class="menu-info">
                                        <h4 class="control-sidebar-subheading">Langdon's Birthday</h4>

                                        <p>Will be 23 on April 24th</p>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0)">
                                    <i class="menu-icon fa fa-user bg-yellow"></i>

                                    <div class="menu-info">
                                        <h4 class="control-sidebar-subheading">Frodo Updated His Profile</h4>

                                        <p>New phone +1(800)555-1234</p>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0)">
                                    <i class="menu-icon fa fa-envelope-o bg-light-blue"></i>

                                    <div class="menu-info">
                                        <h4 class="control-sidebar-subheading">Nora Joined Mailing List</h4>

                                        <p>nora@example.com</p>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0)">
                                    <i class="menu-icon fa fa-file-code-o bg-green"></i>

                                    <div class="menu-info">
                                        <h4 class="control-sidebar-subheading">Cron Job 254 Executed</h4>

                                        <p>Execution time 5 seconds</p>
                                    </div>
                                </a>
                            </li>
                        </ul>
                        <!-- /.control-sidebar-menu -->

                        <h3 class="control-sidebar-heading">Tasks Progress</h3>
                        <ul class="control-sidebar-menu">
                            <li>
                                <a href="javascript:void(0)">
                                    <h4 class="control-sidebar-subheading">
                                        Custom Template Design
                                        <span class="label label-danger pull-right">70%</span>
                                    </h4>

                                    <div class="progress progress-xxs">
                                        <div class="progress-bar progress-bar-danger" style="width: 70%"></div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0)">
                                    <h4 class="control-sidebar-subheading">
                                        Update Resume
                                        <span class="label label-success pull-right">95%</span>
                                    </h4>

                                    <div class="progress progress-xxs">
                                        <div class="progress-bar progress-bar-success" style="width: 95%"></div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0)">
                                    <h4 class="control-sidebar-subheading">
                                        Laravel Integration
                                        <span class="label label-warning pull-right">50%</span>
                                    </h4>

                                    <div class="progress progress-xxs">
                                        <div class="progress-bar progress-bar-warning" style="width: 50%"></div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0)">
                                    <h4 class="control-sidebar-subheading">
                                        Back End Framework
                                        <span class="label label-primary pull-right">68%</span>
                                    </h4>

                                    <div class="progress progress-xxs">
                                        <div class="progress-bar progress-bar-primary" style="width: 68%"></div>
                                    </div>
                                </a>
                            </li>
                        </ul>
                        <!-- /.control-sidebar-menu -->

                    </div>
                    <!-- /.tab-pane -->

                    <!-- Settings tab content -->
                    <div class="tab-pane" id="control-sidebar-settings-tab">
                        <form method="post">
                            <h3 class="control-sidebar-heading">General Settings</h3>

                            <div class="form-group">
                                <label class="control-sidebar-subheading">
                                    Report panel usage
                                    <input type="checkbox" class="pull-right" checked>
                                </label>

                                <p>
                                    Some information about this general settings option
                                </p>
                            </div>
                            <!-- /.form-group -->

                            <div class="form-group">
                                <label class="control-sidebar-subheading">
                                    Allow mail redirect
                                    <input type="checkbox" class="pull-right" checked>
                                </label>

                                <p>
                                    Other sets of options are available
                                </p>
                            </div>
                            <!-- /.form-group -->

                            <div class="form-group">
                                <label class="control-sidebar-subheading">
                                    Expose author name in posts
                                    <input type="checkbox" class="pull-right" checked>
                                </label>

                                <p>
                                    Allow the user to show his name in blog posts
                                </p>
                            </div>
                            <!-- /.form-group -->

                            <h3 class="control-sidebar-heading">Chat Settings</h3>

                            <div class="form-group">
                                <label class="control-sidebar-subheading">
                                    Show me as online
                                    <input type="checkbox" class="pull-right" checked>
                                </label>
                            </div>
                            <!-- /.form-group -->

                            <div class="form-group">
                                <label class="control-sidebar-subheading">
                                    Turn off notifications
                                    <input type="checkbox" class="pull-right">
                                </label>
                            </div>
                            <!-- /.form-group -->

                            <div class="form-group">
                                <label class="control-sidebar-subheading">
                                    Delete chat history
                                    <a href="javascript:void(0)" class="text-red pull-right"><i class="fa fa-trash-o"></i></a>
                                </label>
                            </div>
                            <!-- /.form-group -->
                        </form>
                    </div>
                    <!-- /.tab-pane -->
                </div>
            </aside>
            <!-- /.control-sidebar -->
            <!-- Add the sidebar's background. This div must be placed
                 immediately after the control sidebar -->
            <div class="control-sidebar-bg"></div>
            <div id="modal-container-dialog-info" class="modal fade" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                            <h3 id="model_info_title">
                                提示
                            </h3>
                        </div>
                        <div class="modal-body">
                            <p id="modal_info_content"   style=" color: red; font-size: 30px" >
                            </p>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">确认</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ./wrapper -->

        <!-- change password -->
        <div class="modal fade" id="model_changePWd">
            <div class="modal-dialog">
                <div class="modal-content" >
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <h4 class="modal-title" lang="text:change_pwd">更改密码</h4>
                    </div>
                    <div class="modal-body">
                        <form class="form-horizontal" id="model_changePWd_form" >
                            <div class="form-group">
                                <label class="col-sm-4 control-label" >
                                    <span lang="text:old_pwd"></span ><span class="text-red">*</span>
                                </label>
                                <div class="col-sm-8">
                                    <input type="password" class="form-control validate[required,maxSize[16],funcCall[cloudInput]]" name="old_pwd" id="model_changePWd_oldPwd"
                                           placeholder="旧密码" lang="placeholder:old_pwd">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-4 control-label" >
                                    <span lang="text:new_pwd"></span ><span class="text-red">*</span>
                                </label>
                                <div class="col-sm-8">
                                    <input type="password" class="form-control validate[required,custom[password],minSize[6],maxSize[16],funcCall[cloudInput]]" name="new_pwd" id="model_changePWd_newPwd"
                                          lang="placeholder:new_pwd">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-4 control-label" >
                                    <span lang="text:repeat_pwd"></span ><span class="text-red">*</span>
                                </label>
                                <div class="col-sm-8">
                                    <input type="password" class="form-control validate[required,custom[password],minSize[6],maxSize[16],equals[model_changePWd_newPwd],funcCall[cloudInput]]"
                                           name="repeat_pwd" id="model_changePWd_repeat_pwd"  lang="placeholder:repeat_pwd">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default pull-left" data-dismiss="modal" lang="text:close"> </button>
                        <button type="button" class="btn btn-primary" onclick="submit_changePassword_self()" lang="text:submit"> </button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
        <script>
            $("#model_changePWd [data-dismiss]").on("click", function() {
                $("#model_changePWd_oldPwd").val("");
                $("#model_changePWd_newPwd").val("");
                $("#model_changePWd_repeat_pwd").val("");
                $(".formError.inline").remove();
            });
        </script>
        <!-- change password -->

        <script>
            //提示信息
            function alertInfo(msg) {
                $('#modal_info_content').text(msg);
                $('#modal-container-dialog-info').modal('show');
            }
            ;
            //关闭提示
            function alertConfirm() {
                $('#modal-container-dialog-info').modal('hide');
            }

            //正在加载
            function loading() {
                $(".overlay").show();
            }
            //加载完成
            function unload() {
                $(".overlay").hide();
            }


            function checkUserName(userName) {
                var reg = new RegExp('^[a-z\d]{6,12}'); // 小写字母
                return reg.test(userName);
            }
            ;
            function checkPassword(userPassword) {
                //var reg = new RegExp('(?=.*[0-9])(?=.*[a-zA-Z])(?=.*[^a-zA-Z0-9]).{8,30}'); // 密码中必须包含字母、数字、特称字符，至少8个字符，最多30个字符
                //return reg.test(userPassword);
                return true;
            }
            ;
            //获取当前用户信息
            function getUserInfo() {
                getAPI2_user_this({verbose: 100}, function(data) {
                    $("#user_info_1").text(typeof(data.result.name)=='undefined' ? "" :data.result.name);
                    $("#user_info_2").text(typeof(data.result.email)=='undefined' ? "" :data.result.email);
                    $("#user_info_3").text(typeof(data.result.name)=='undefined' ? "" :data.result.name);
                    $("#user_info_3").attr('title', typeof(data.result.name)=='undefined' ? "" :data.result.name);
                    $("#user_phone,#user_phone_hidden").text(typeof(data.result.phone)=='undefined' ? "" :data.result.phone);
                    $("#user_name,#user_name_hidden").text(typeof(data.result.name)=='undefined' ? "" :data.result.name);
                    $("#user_id").val(data.result._id);
                    var name=typeof(data.result.roleName)=='undefined' ? "" : data.result.roleName;
                    if(name=="admin") {
                        name = locale.get("dn_admin");
                    }else if(name=="DeviceManager") {
                        name = locale.get("device_manager");
                    }else if(name=="DeviceSense") {
                        name = locale.get("device_sense");
                    }
                    $("#user_rolename").text(name);
                    $("#last_login_ts").text(typeof(data.result.lastLogin)=='undefined' ? "" :schneider.util.dateFormat(data.result.lastLogin , "yyyy-MM-dd hh:mm:ss"));
                    $("#last_logout_ts").text(typeof(data.result.lastLogout)=='undefined' ? "" :schneider.util.dateFormat(data.result.lastLogout, "yyyy-MM-dd hh:mm:ss"));
                    $("#last_login_ip").text(typeof(data.result.lastIp)=='undefined' ? "" :data.result.lastIp);
                    if (data.result.photoFileId && data.result.photoFileId != undefined) {
                        $("#user_img_1").attr("src", "/api/file/" + data.result.photoFileId + "?access_token=" + sessionStorage.getItem("accessToken"));
                        $("#user_img_2").attr("src", "/api/file/" + data.result.photoFileId + "?access_token=" + sessionStorage.getItem("accessToken"));
                        $("#user_img_3").attr("src", "/api/file/" + data.result.photoFileId + "?access_token=" + sessionStorage.getItem("accessToken"));
                    }

                }, this);

            }
            //获取当前用户角色的权限信息
            function getUserPrivileges() {
                getOauth2_get_token_info(function(data) {
                    sessionStorage.setItem("accept", data.privileges.accept);
                    sessionStorage.setItem("default", data.privileges.default);
                    sessionStorage.setItem("deny", data.privileges.deny);
                    permissionFilter_pageFunc();
                    //权限过滤菜单
                    nav_permission();
                    init();
                }, this);
            }
            ;
            function logout() {
                dialog.render({
                    lang: "affirm_logout",
                    buttons: [{lang: "yes", click: function() {
                                schneider.Ajax.request({
                                    url: "api2/logout",
                                    type: "GET",
                                    async: false,
                                    success: function(result) {
                                        dialog.close();
                                        sessionStorage.removeItem("accessToken");
                                        sessionStorage.removeItem("refreshToken");
                                        sessionStorage.removeItem("failedTimes");
                                        sessionStorage.removeItem("default");
                                        sessionStorage.removeItem("deny");
                                        sessionStorage.removeItem("accept");
                                        closeNews();
                                        window.location.href = 'login.html';

                                    }
                                });
                            }}, {lang: "no", click: function() {
                                dialog.close();
                            }}],
                    close: function() {
                        dialog.close();
                    }
                });
            }
            //点击查看告警显示active状态
            $("#check_alarm").click(function() {
                $("#alarmList>a").click();
                setTimeout(function() {
                    $(".treeview-menu li").removeClass("active");
                    $("#alarmList_alarmManage").addClass("active");
                }, 510);
                $("#alarmList_alarmManage a").click();
            });

            /**
             * 子菜单绑定点击事件  选中当前选项
             * */
            $(".treeview-menu li").bind("click", function() {
                var $this = $(this);
                $(".treeview-menu li").removeClass("active");
                $this.addClass("active");
            });

            //记录所有打开的子窗口
            var win_Array = new Array();
            var win_num = -1;
            function detail_popUp(_id) {
                
                 var win = window.open("", "_blank");
                getSiteById(_id,{verbose:1},function(data){
                    if(typeof(data.result)!="undefined") {

                        function loc(){
                            var loc = "siteDetail/siteDetail_index.html?id=" + _id;
                            win.location = loc;
                            win_Array.push(win);
                        }

                        setTimeout(loc(),800);//这个等待很重要，如果不等待的话将无法实现
                    }else {
                        win.close();
                        errorTipDis("the_site_has_been_deleted");
                    }
                },this);

            }
            //注销的时候，执行关闭方法。body添加onUnload = "closeNews();" 当main窗口关闭时候，所有的子窗口关闭
            function closeNews() {
                if (win_Array.length > 0) {
                    for (var i = 0; i <= win_Array.length; i++) {
                        var win_one = win_Array[i];
                        if (win_one != undefined) {
                            win_one.close();
                        }
                    }
                }
            }
            // judge the permission of scada
            function scada_perr() {
                // console.log( window.schneider);
                var scada_perr = 95;
                var accept=sessionStorage.getItem('accept');
                var def=sessionStorage.getItem('default');
                var deny=sessionStorage.getItem('deny');
                var accept_a = accept.split( ",");
                var deny_d = deny.split( ",");
                var marker = 0;
                if( $.inArray( scada_perr, deny) > -1) {
                    marker = 0;
                } else {
                    if( $.isArray( scada_perr, accept_a)) {
                        marker = 1;
                    } else {
                        if( def == "all") {
                            marker = 1;
                        } else if( def == "none"){
                            marker = 0;
                        } else {
                            if( parseInt( scada_perr) % 2 == 0) {
                                marker = 0;
                            } else {
                                marker = 0;
                            }
                        }
                    }
                }
                if( marker == 1) {
                    // schneider.Global.init();
                }
            };

        </script>
    </body>

    <!--LeafletMap-->
    <!--Start-->
    <!--<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />-->
    <!--<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>-->
    <link rel="stylesheet" href="plugins/leaflet/leaflet.css" />
    <link rel="stylesheet" href="plugins/leaflet/leaflet.draw.css" />
    <script src="plugins/leaflet/leaflet-Google.js"></script>
    <script src="plugins/leaflet/leaflet.js"></script>
    <script src="plugins/leaflet/leaflet-Layer.Deferred.js"></script>
    <!--END-->
</html>
