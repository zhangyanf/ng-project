<div class="col-md-12">
    <div style="padding:0 150px" id="modal_add_update_div">
        <form class="form-horizontal" id="add_edit_form">
            <!--清空form数据-->
            <input type="reset" style="display:none;" id="form_reset" />
            <div style="text-align:center ">
                <input type="hidden" id="gatewayId" value="" />
                <input type="hidden" id="oldinfo-serial-number" value="" />
                <input type="hidden" id="oldGateName" value="" />
            </div>
            <br />
            <div class="form-group">
                <label class="col-sm-4 control-label"><span  lang="text:serial_number"></span ><span class="text-red">*</span></label>
                <div class="col-sm-6" style="padding-left: 7px;padding-right: 1px;">
                    <input type="text" onblur="match＿model();" class="form-control validate[required,custom[serialNumber2],funcCall[cloudInput]]" value="" id="info-serial-number">
                    <div id="gatewaySerialtest" style="display:none;opacity: 0.87; position: relative; top: 0px; left: 0px; margin-top: 0px;border-radius: 3px;background: #ffebeb;color: #df1a08; border: 1px solid #df1a08;">
                        <span lang="text:the_gateway_has_been_binding"></span>
                        <br />
                    </div>
                </div>
            </div>
            <div class="gateway_div">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span lang="text:gateway_name"></span><span class="text-red">*</span></label>
                    <div class="col-sm-6" style="padding-left: 7px;padding-right: 1px;" id="gatewayNameDiv">
                        <input type="text" class="form-control validate[required,minSize[0],custom[giveName],maxSize[30],funcCall[cloudInput]]" value="" id="name" gId="" optionDataType="">
                        <div id="gatewayNametest" style="display:none;opacity: 0.87; position: relative; top: 0px; left: 0px; margin-top: 0px;border-radius: 3px;background: #ffebeb;color: #df1a08; border: 1px solid #df1a08;">
                            <span lang="text:gateway_already_exists"></span>
                            <br />
                        </div>
                    </div>
                </div>
                <div class="form-group" style="display:none;" id="isboundDiv">
                    <label class="col-sm-4 control-label" lang="text:site_name"></label>
                    <div class="col-sm-6" style="padding-left: 7px;padding-right: 1px;">
                    <input type="text" class="form-control input-sm" id="boundSiteName" readonly="readonly" lang="placeholder:site_name" >
                    <button type="button" id="gatewayId_i" style="display: block;margin-top: -30px;height:30px;"  class="btn btn-default btn-sm pull-right" data-toggle="tooltip"  lang="title:unbound">
                        <i class="iconfont icon-jiebang" style="cursor:pointer;top: 9px; font-size:20px;"></i>
                    </button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-4 control-label" lang="text:mobile_number"></label>
                    <div class="col-sm-6" style="padding-left: 7px;padding-right: 1px;">
                        <input type="text" class="form-control validate[custom[phone1],maxSize[20],minSize[8],funcCall[cloudInput]]" value="" id="info-mobilenumber">
                    </div>
                </div>
                <div class="form-group" id="div_model">
                    <label class="col-sm-4 control-label" lang="text:model"></label>
                    <div class="col-sm-6" style="padding-left: 7px;padding-right: 1px;">
                        <select id="info-model" class="form-control">

                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-4 control-label" lang="text:business_state"></label>
                    <div class="col-sm-6" style="padding-left: 7px;padding-right: 1px;">
                        <select id="info-business-state" class="form-control">
                            <option value="0" lang="text:construction" selected="selected"></option>
                            <option value="1" lang="text:commissioning"></option>
                            <option value="2" lang="text:fault"></option>
                            <option value="3" lang="text:overhaul"></option>
                        </select>
                    </div>
                </div>
                <!--网关配置月流量预警选项-->
                <div class="form-group">
                    <div style="margin-bottom: 10px;">
                        <label lang="text:show_warning_options"></label>
                        <span class="glyphicon glyphicon-triangle-bottom" id="CTRight_alarmOptions" data-toggle="collapse" onclick="change_alarmOptionsContent()" href="#alarmOptions_content" aria-expanded="false" aria-controls="advanceOptions_content" style="cursor: pointer;margin-left: 10px;"></span>
                    </div>
                    <div id="alarmOptions_content" class="collapse" ><!--style="border: 1px solid #e5e5e5;"-->
                        <div style="width: 100%;">
                            <label style=" margin-left:25px;display: inline-block;" lang="text:show_threshold"></label>
                            <div class="form-group" style="font-size: 12px;margin-bottom: 5px;margin-right: 1px;margin-left: 1px;">
                                <label class="col-sm-4 control-label" lang="text:warning"></label>
                                <div class="col-sm-6" style="padding-left: 7px;padding-right: 1px;">
                                    <input type="text" class="form-control validate[custom[number]],funcCall[alaRule]" value="" id="info-device-warning" style="height: 26px;">
                                </div>
                                <div class="col-sm-1" style="padding-left: 1px;padding-right: 1px;padding-top: 7px;" lang="text:mega">
                                    M
                                </div>
                            </div>
                            <div class="form-group" style="font-size: 12px;margin-bottom: 5px;margin-right: 1px;margin-left: 1px;">
                                <label class="col-sm-4 control-label" lang="text:alarm"></label>
                                <div class="col-sm-6" style="padding-left: 7px;padding-right: 1px;">
                                    <input type="text" class="form-control validate[custom[number],funcCall[alaRule]]" value="" id="info-warn-alarm" style="height: 26px;">
                                </div>
                                <div class="col-sm-1" style="padding-left: 1px;padding-right: 1px;padding-top: 7px;" lang="text:mega">
                                    M
                                </div>
                            </div>
                            <div class="form-group" style="font-size: 12px;margin-bottom: 5px;margin-right: 1px;margin-left: 1px;">
                                <label class="col-sm-4 control-label" lang="text:serious"></label>
                                <div class="col-sm-6" style="padding-left: 7px;padding-right: 1px;">
                                    <input type="text" class="form-control validate[custom[number],funcCall[alaRule]]" value="" id="info-device-serious" style="height: 26px;">
                                </div>
                                <div class="col-sm-1" style="padding-left: 1px;padding-right: 1px;padding-top: 7px;" lang="text:mega">
                                    M
                                </div>
                            </div>
                            <div class="form-group" style="font-size: 12px;margin-bottom: 5px;margin-right: 1px;margin-left: 1px;">
                                <label class="col-sm-4 control-label" lang="text:warnhours"></label>
                                <div class="col-sm-6" style="padding-left: 7px;padding-right: 1px;">
                                    <input type="text" class="form-control validate[custom[number],funcCall[alaRule]]" value="" id="info-device-hours" style="height: 26px;">
                                </div>
                                <div class="col-sm-1" style="padding-left: 1px;padding-right: 1px;padding-top: 7px;" lang="text:mega">
                                    M
                                </div>
                            </div>
                            <div class="col-sm-10" id="warningseTips11" style="margin: 13px auto;display:none;">
                                <span style="color:red;">*<label style="color:red;" lang="text:warn_tip"></label></span>
                            </div>
                            <div class="col-sm-10" id="warningseTips22" style="margin: 13px auto;display:none;">
                                <span style="color:red; ">*<label style="color:red;" lang="text:warnings_tip"></label></span>
                            </div>
                            <div class="col-sm-10" id="warningseTips33" style="margin: 13px auto;display:none;">
                                <span style="color:red; ">*<label style="color:red;" lang="text:warning_tip"></label></span>
                            </div>
                            <div class="form-group" style="font-size: 12px;margin-bottom: 5px;margin-right: 1px;margin-left: 1px;">
                                <label class="col-sm-4 control-label" lang="text:show_recipient"></label>
                                <div class="col-sm-6" style="padding-left: 7px;padding-right: 1px;" id="reTextarea">
                                    <textarea class="form-control validate[funcCall[emailRule]]" id="reContent" style="  resize: none; " lang="placeholder:mailbox_tip"></textarea><br>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--网关配置高级选项-->
                <!--<div class="form-group">
                    <div style="margin-bottom:10px;">
                        <label lang="text:advanced_options"></label>
                        <span class="glyphicon glyphicon-triangle-bottom" id="CTRight_advanceOptions" data-toggle="collapse" onclick="change_advanceOptionsContent()" href="#advanceOptions_content" aria-expanded="false" aria-controls="advanceOptions_content" style="cursor: pointer;margin-left: 10px;"></span>
                    </div>
                    <div id="advanceOptions_content" class="collapse" >&lt;!&ndash;style="border: 1px solid #e5e5e5;"&ndash;&gt;
                        <div style="width: 100%;">
                            &lt;!&ndash;<div class="form-group" style="font-size: 12px;margin-bottom: 5px;margin-top:10px;margin-right: 1px;margin-left: 1px;">
                                <label class="col-sm-4 control-label"><span lang="text:heartbeat_timeout"></span ><span class="text-red">*</span></label>
                                <div class="col-sm-6" style="padding-left: 7px;padding-right: 1px;">
                                    <input type="text" class="form-control validate[required,custom[number],min[1],maxSize[6],funcCall[cloudInput]]" value="10" id="info-device-advanced-heartbeattimeout" style="height: 26px;">
                                </div>
                                <div class="col-sm-2" style="padding-left: 1px;padding-right: 1px;padding-top: 7px;" lang="text:seconds"></div>
                            </div>&ndash;&gt;
                            <div class="form-group" style="font-size: 12px;margin-bottom: 5px;margin-right: 1px;margin-left: 1px;">
                                <label class="col-sm-4 control-label"><span lang="text:heartbeat_interval"></span ><span class="text-red">*</span></label>
                                <div class="col-sm-6" style="padding-left: 7px;padding-right: 1px;">
                                    <input type="text" class="form-control validate[required,custom[number],min[30],max[600],funcCall[cloudInput]]" value="120" id="info-device-advanced-heartbeatinterval" style="height: 26px;">
                                </div>
                                <div class="col-sm-2" style="padding-left: 1px;padding-right: 1px;padding-top: 7px;" lang="text:seconds"></div>
                            </div>
                           &lt;!&ndash; <div class="form-group" style="font-size: 12px;margin-bottom: 5px;margin-right: 1px;margin-left: 1px;">
                                <label class="col-sm-4 control-label"><span lang="text:max_heartbeat_lost"></span ><span class="text-red">*</span></label>
                                <div class="col-sm-6" style="padding-left: 7px;padding-right: 1px;">
                                    <input type="text" class="form-control validate[required,custom[number],min[1],max[20],funcCall[cloudInput]]" value="6" id="info-device-advanced-maxheartbeatlost" style="height: 26px;">
                                </div>
                            </div>
                            <div class="form-group" style="font-size: 12px;margin-bottom: 5px;margin-right: 1px;margin-left: 1px;">
                                <label class="col-sm-4 control-label"><span lang="text:resend_login"></span><span class="text-red">*</span></label>
                                <div class="col-sm-6" style="padding-left: 7px;padding-right: 1px;">
                                    <input type="text" class="form-control validate[required,custom[number],min[1],maxSize[6],funcCall[cloudInput]]" value="60" id="info-device-advanced-resendlogin" style="height: 26px;">
                                </div>
                                <div class="col-sm-2" style="padding-left: 1px;padding-right: 1px;padding-top: 7px;" lang="text:seconds"></div>
                            </div>
                            <div class="form-group" style="font-size: 12px;margin-bottom: 5px;margin-right: 1px;margin-left: 1px;">
                                <label class="col-sm-4 control-label"><span lang="text:connection_timeout"></span ><span class="text-red">*</span></label>
                                <div class="col-sm-6" style="padding-left: 7px;padding-right: 1px;">
                                    <input type="text" class="form-control validate[required,custom[number],min[1],maxSize[6],funcCall[cloudInput]]" value="300000" id="info-device-advanced-timeout" style="height: 26px;">
                                </div>
                                <div class="col-sm-2" style="padding-left: 1px;padding-right: 1px;padding-top: 7px;" lang="text:milliscond"></div>
                            </div>
                            <div class="form-group" style="font-size: 12px;margin-bottom: 5px;margin-right: 1px;margin-left: 1px;">
                                <label class="col-sm-4 control-label"><span lang="text:ack_timeout"></span ><span class="text-red">*</span></label>
                                <div class="col-sm-6" style="padding-left: 7px;padding-right: 1px;">
                                    <input type="text" class="form-control validate[required,custom[number],min[1],maxSize[6],funcCall[cloudInput]]" value="120000" id="info-device-advanced-acktimeout" style="height: 26px;">
                                </div>
                                <div class="col-sm-2" style="padding-left: 1px;padding-right: 1px;padding-top: 7px;" lang="text:milliscond"></div>
                            </div>
                            <div class="form-group" style="font-size: 12px;margin-bottom: 5px;margin-right: 1px;margin-left: 1px;">
                                <label class="col-sm-4 control-label"><span  lang="text:ack_retries"></span ><span class="text-red">*</span></label>
                                <div class="col-sm-6" style="padding-left: 7px;padding-right: 1px;">
                                    <input type="text" class="form-control validate[required,custom[number],min[1],maxSize[6],funcCall[cloudInput]]" value="3" id="info-device-advanced-ackretries" style="height: 26px;">
                                </div>
                            </div>
                            <div class="form-group" style="font-size: 12px;margin-bottom: 5px;margin-right: 1px;margin-left: 1px;">
                                <label class="col-sm-4 control-label" lang="text:sync_config"></label>
                                <div class="col-sm-6" style="padding-left: 7px;padding-right: 1px;">
                                    <select id="info-device-advanced-sync" class="form-control input-sm">
                                        <option value="2" lang="text:keep_device"></option>
                                        <option value="1" lang="text:keep_platform" selected="true"></option>
                                        <option value="0" lang="text:ignore"></option>
                                    </select>
                                </div>
                            </div>&ndash;&gt;
                        </div>
                    </div>
                </div>-->
            </div>
            <br />
        </form>
    </div>
</div>

<!--网关配置js代码区!-->
<script>
    /*----------------网关配置js代码区---------------*/

    //网关配置 在编辑与新增现在的时候 根据现场的ID值 来进行
    //在保存时候需要先将现场保存后 再去获取id值，然后再去保存网关信息

    //初始化网关配置表单验证配置
    validator.render("#add_edit_form", {
        promptPosition: "inline",
        scroll: false
    });

    //根据序列号触发是否回填网关信息

    $("#info-serial-number").blur(function() {
        search();
    });

    //校验网关名是否存在
    $("#name").blur(function() {
        if($("#gatewayNameDiv .formErrorContent").length<=0) {
            testName();
        }
    });

    //校验网关是否存在
    function testName() {
        var name = $.trim($("#name").val());
        var oldGatewayName = $("#oldGateName").val();
        if (name != "" && name != oldGatewayName) {
            var flag = false;
            var params = {
                "verbose": 100,
                "name": name
            };
            // 查询网关
            searchGateway(false, params, function(data) {
                if (typeof(data.result) != "undefined" && data.result.length > 0) {
                    for (var i = 0; i < data.result.length; i++) {
                        if (data.result[i].name == name) {
                            flag = true;
                            break;
                        }
                    }
                }
            }, this);
            if (flag) {
                $("#gatewayNametest").show();
            } else {
                $("#gatewayNametest").hide();
            }
        }
    }

    // 根据网关序列号查询网关数据
    function search() {
        var serialNumber = $("#info-serial-number").val();
        var oldSerialNumber = $("#oldinfo-serial-number").val();
        if (serialNumber == "") {
            $(".gateway_div").hide();
            $("#form_reset").click();
        }
        if (serialNumber != oldSerialNumber) {
            if (serialNumber.search(/^[a-zA-Z]{2}[0-9]{13}$/) != -1) {
                var params = {
                    "verbose": 100,
                    "serial_number": serialNumber
                };
                // 查询网关
                searchGateway(true, params, function(data) {
                    if (data.total == 0) {
                        //1.没有该网关信息（添加网关配置）
                        $("#gatewaySerialtest").hide();
                        $("#form_reset").click();
                        $("#oldGateName").val("");
                        $("#oldinfo-serial-number").val("");
                        $("#info-model").prop("disabled", "");
                        $("#info-serial-number").val(serialNumber);
                        $(".gateway_div").show();
                    } else {
                        if (data.result[0].siteName) {
                            //2.有该网关信息但是绑定了现场（添加网关配置）
                            $("#gatewaySerialtest").show();
                            $("#form_reset").click();
                            $("#oldGateName").val("");
                            $("#oldinfo-serial-number").val("");
                            $("#info-model").prop("disabled", "");
                            $("#info-serial-number").val(serialNumber);
                            $(".gateway_div").hide();
                        } else {
                            //3.有该网关信息但是没有绑定现场（回填网关配置）
                            $("#gatewaySerialtest").hide();
                            $("#form_reset").click();
                            $("#oldGateName").val("");
                            $("#oldinfo-serial-number").val("");
                            $(".gateway_div").show();
                            getMonthAlarmInfo(data.result[0]._id, function(data2) {
                                loading1();
                                fillGatewayInfo(data.result[0], data2.result, false);
                                unload1();
                            }, this);
                        }
                    }
                }, this);
            }
        }
    }

    //获取一个网关具体数据
    function    getOneGatewayInfo(gId) {
        getOneGatewayOverviewInfo(gId, function(data) {
            getMonthAlarmInfo(gId, function(data2) {
                loading1();
                fillGatewayInfo(data.result, data2.result, true);
                unload1();
            }, this);
        }, this);
    }

    //网关数据回填
    function fillGatewayInfo(data, data2, flag) {
        loading1();
        $("#name").val(data.name);
        $("#gatewayId").val(data._id);
       // $("#info-device-advanced-timeout").val(data.config.timeout);
       // $("#info-device-advanced-acktimeout").val(data.config.ackTimeout);
       // $("#info-device-advanced-ackretries").val(data.config.ackRetries);
      //  $("#info-device-advanced-maxheartbeatlost").val(data.deviceConfig.maxHeartbeatLost);
         // $("#info-device-advanced-heartbeatinterval").val(data.deviceConfig.heartbeatInterval);
       // $("#info-device-advanced-heartbeattimeout").val(data.deviceConfig.heartbeatTimeout);
       // $("#info-device-advanced-resendlogin").val(data.deviceConfig.resendLogin);
        $("#info-mobilenumber").val(data.mobileNumber);
        $("#info-serial-number").val(data.serialNumber);
        $("#oldinfo-serial-number").val(data.serialNumber);
        $("#oldGateName").val(data.name);
        if (flag) {
            $("#info-serial-number").attr("readonly", "readonly");
        }
        $("#info-model").prop("disabled", "disabled");
        // 如果有Ip 基站 信号强度信息，就显示出来
        var $div = "";
        if (typeof(data.pubIp) != "undefined") {
            var ip = data.pubIp;
            $div += '<div id="div_ip">' +
                '<label class="col-sm-4" lang="text:ip" style="text-align:right;margin-top:13px;">ip</label>' +
                '<div class="col-sm-6" style="padding-left: 8px;padding-right: 1px;;margin-bottom: 15px;margin-top:15px;">' +
                '<span id="info-device-ip" style="width:90px" readonly="readonly">' + ip + '</span>' +
                '</div>' +
                '</div>';
        }

        if (typeof(data.info) != "undefined") {
            var dataInfo_mcc = typeof(data.info.mcc) == "undefined" ? "" : data.info.mcc;
            var dataInfo_mnc = typeof(data.info.mnc) == "undefined" ? "" : data.info.mnc;
            var dataInfo_lac = typeof(data.info.lac) == "undefined" ? "" : data.info.lac;
            var dataInfo_cid = typeof(data.info.cid) == "undefined" ? "" : data.info.cid;
            var base_station = "";
            if (dataInfo_mcc != "" && dataInfo_mnc != "" && dataInfo_lac != "" && dataInfo_cid != "") {
                base_station = dataInfo_mcc + "." + dataInfo_mnc + "." + dataInfo_lac + "." + dataInfo_cid;
                $div += '<div id="div_base">' +
                    '<label class="col-sm-4" lang="text:base_station" style="text-align: right;margin-bottom: 15px;"></label>' +
                    '<div class="col-sm-6" style="padding-left: 8px;padding-right: 1px;margin-bottom: 15px;">' +
                    '<span id="info-device-basestation" style="width:90px" readonly="readonly">' + base_station + '</span>' +
                    '</div>' +
                    '</div>';
            }
            var rssi = (typeof(data.info.rssi) == "undefined" || data.info.rssi == "") ? 0 : data.info.rssi;
            var signal = -113 + 2 * parseInt(rssi);
            $div += '<div id="div_signal">' +
                '<label class="col-sm-4" lang="text:signal_strength" style="text-align: right;margin-top:4px;"></label>' +
                '<div class="col-sm-6" style="padding-left: 7px;padding-right: 1px;">' +
                '<span id="info-device-signal-num" style="width:90px" readonly="readonly">' + signal + ' dBm</span>';

            if (signal > -91) { //五格
                $div += '<span style="width: 19px;height: 16px;margin: 3px 0 0 2px;background-image: url(images/signal-5.png);display: inline-block;"/>';
            } else if (signal > -101) { //四格
                $div += '<span style="width: 19px;height: 16px;margin: 3px 0 0 2px;background-image: url(images/signal-4.png);display: inline-block;"/>';
            } else if (signal > -103) { //三格
                $div += '<span style="width: 19px;height: 16px;margin: 3px 0 0 2px;background-image: url(images/signal-3.png);display: inline-block;"/>';
            } else if (signal > -107) { //两格
                $div += '<span style="width: 19px;height: 16px;margin: 3px 0 0 2px;background-image: url(images/signal-2.png);display: inline-block;"/>';
            } else if (signal > -113) { //一格
                $div += '<span style="width: 19px;height: 16px;margin: 3px 0 0 2px;background-image: url(images/signal-1.png);display: inline-block;"/>';
            } else { //无信号
                $div += '<span style="width: 19px;height: 16px;margin: 3px 0 0 2px;background-image: url(images/signal-0.png);display: inline-block;"/>';
            }
            $div += '</div></div>';
        }
        if ($div != "") {
            $("#div_model").append($div);
        }
       /* var sync = data.config.sync;
        $("#info-device-advanced-sync option").each(function() {
            var $option = $(this);
            if ($option.val() == sync) {
                $option.prop("selected", "selected");
            }
        });*/
        var businessState = data.businessState;
        $("#info-business-state option").each(function() {
            var $option = $(this);
            if ($option.val() == businessState) {
                $option.prop("selected", "selected");
            }
        });
        var modelId = data.modelId;
        $("#info-model option").each(function() {
            var $option = $(this);
            if ($option.val() == modelId) {
                $option.prop("selected", "selected");
            }
        });
        if (data2) {
            $("#reContent").val(data2.emailList);
            $("#info-device-hours").val(data2.hoursWarn);
            $("#info-device-warning").val(data2.warning1);
            $("#info-warn-alarm").val(data2.warning2);
            $("#info-device-serious").val(data2.warning3);
        }
        unload1();
        locale.render({
            element: "body"
        });
    }

    //关闭_高级选项区域
    function close_advanceOptionsContent() {
        if ($("#CTRight_advanceOptions").attr("aria-expanded") == 'true') {
            $("#CTRight_advanceOptions").attr("aria-expanded", false);
            $("#CTRight_advanceOptions").removeClass();
            $("#CTRight_advanceOptions").addClass("glyphicon glyphicon-triangle-bottom collapsed");
            $("#advanceOptions_content").attr("aria-expanded", false);
            $("#advanceOptions_content").removeClass();
            $("#advanceOptions_content").addClass("collapse");

        }
    }

    //面板_高级区域闭合
    function change_advanceOptionsContent() {
        if ($("#CTRight_advanceOptions").attr("aria-expanded") == 'true') {
            $("#CTRight_advanceOptions").removeClass();
            $("#CTRight_advanceOptions").addClass("glyphicon glyphicon-triangle-bottom");
        }
        if ($("#CTRight_advanceOptions").attr("aria-expanded") == 'false') {
            $("#CTRight_advanceOptions").removeClass();
            $("#CTRight_advanceOptions").addClass("glyphicon glyphicon-triangle-top");
        }
    }

    //关闭_月流量预警区域
    function close_alarmOptionsContent() {
        if ($("#CTRight_alarmOptions").attr("aria-expanded") == 'true') {
            $("#CTRight_alarmOptions").attr("aria-expanded", false);
            $("#CTRight_alarmOptions").removeClass();
            $("#CTRight_alarmOptions").addClass("glyphicon glyphicon-triangle-bottom collapsed");
            $("#alarmOptions_content").attr("aria-expanded", false);
            $("#alarmOptions_content").removeClass();
            $("#alarmOptions_content").addClass("collapse");

        }
    }

    //面板_月流量预警区域闭合
    function change_alarmOptionsContent() {
        if ($("#CTRight_alarmOptions").attr("aria-expanded") == 'true') {
            $("#CTRight_alarmOptions").removeClass();
            $("#CTRight_alarmOptions").addClass("glyphicon glyphicon-triangle-bottom");
        }
        if ($("#CTRight_alarmOptions").attr("aria-expanded") == 'false') {
            $("#CTRight_alarmOptions").removeClass();
            $("#CTRight_alarmOptions").addClass("glyphicon glyphicon-triangle-top");
        }
    }

    // 根据序列号匹配机型
    function match＿model() {
        var serialNumber = $("#info-serial-number").val();
        if (serialNumber.length == 15) {
            // $(".gateway_div").show();
            var p1 = serialNumber.substring(0, 1); //判断是Router还是DTU
            var p2 = serialNumber.substring(1, 2); //判断网络
            var p3 = serialNumber.substring(2, 3); //判断700还是300还是600,900
            var p4 = serialNumber.substring(3, 4); //是300还是320
            var deviceType = $("#info-model option");
            if (p1 == "R" || p1 == "r") { //Router
                if (p3 == 7) { //700
                    if (p2 == "w" || p2 == "W") {
                        selectModel("IR7XX_WCDMA", deviceType);
                    } else if (p2 == "v" || p2 == "V") {
                        selectModel("IR7XX_EVDO/CDMA", deviceType);
                    } else if (p2 == "g" || p2 == "G") {
                        selectModel("IR7XX_GPRS/EDGE", deviceType);
                    } else if (p2 == "u" || p2 == "U") {
                        selectModel("IR7XX_UE", deviceType);
                    } else if (p2 == "c" || p2 == "C") {
                        selectModel("IR7XX_EVDO/CDMA", deviceType);
                    } else if (p2 == "e" || p2 == "E") {
                        selectModel("IR7XX_GPRS/EDGE", deviceType);
                    } else if (p2 == "t" || p2 == "T") {
                        selectModel("IR7XX_TD-SCDMA", deviceType);
                    }
                } else if (p3 == 3) { //300
                    if (p4 == 2) {
                        selectModel("IR320", deviceType);
                    } else {
                        selectModel("IR300", deviceType);
                    }
                } else if (p3 == 9) {
                    if (p2 == "p" || p2 == "P") {
                        selectModel("IR9XX_WCDMA", deviceType);
                    } else if (p2 == "v" || p2 == "V") {
                        selectModel("IR9XX_EVDO", deviceType);
                    } else if (p2 == "t" || p2 == "T") {
                        selectModel("IR9XX_TDD-LTE", deviceType);
                    } else if (p2 == "f" || p2 == "F") {
                        selectModel("IR9XX_FDD-LTE", deviceType);
                    }
                } else if (p3 == 6) {
                    if (p2 == "w" || p2 == "W") {
                        selectModel("IR6XX_WCDMA", deviceType);
                    } else if (p2 == "v" || p2 == "V") {
                        selectModel("IR6XX_EVDO", deviceType);
                    } else if (p2 == "t" || p2 == "T") {
                        selectModel("IR6XX_TD", deviceType);
                    }
                }
            } else if (p1 == "D" || p1 == "d") { //DTU
                selectModel("InDTU3XX_GPRS/EDGE", deviceType);
            } else if (p1 == "p" || p1 == "P") {
                if (p2 == "p" || p2 == "P") {
                    selectModel("IR8XX_WCDMA", deviceType);
                } else if (p2 == "f" || p2 == "F") {
                    selectModel("IR8XX_FDD-LTE", deviceType);
                } else if (p2 == "t" || p2 == "T") {
                    selectModel("IR8XX_TDD-LTE", deviceType);
                } else if (p2 == "v" || p2 == "V") {
                    selectModel("IR8XX_EVDO", deviceType);
                }
            } else if (p1 == "g" || p1 == "G") {
                if (p2 == "p" || p2 == "P") {
                    selectModel("IG601_HSPA+", deviceType);
                } else if (p2 == 'V' || p2 == 'V') {
                    selectModel("IG601_EVDO", deviceType);
                }
            }
        }
    }
    // 设置机型
    function selectModel(mid, modelArray) {
        for (var i = 0; i < modelArray.length; i++) {
            if (modelArray[i].innerHTML == mid) {
                modelArray[i].selected = true;
                break;
            }
        }
    }

    //提交网关数据 //保存网关数据
    function submitDate(siteId, siteName) {
        var params = {};
        var name = $("#name").val();
        var id = $("#gatewayId").val();
       // var timeout = $("#info-device-advanced-timeout").val();
        //var ackTimeout = $("#info-device-advanced-acktimeout").val();
       // var ackRetries = $("#info-device-advanced-ackretries").val();
       // var sync = $("#info-device-advanced-sync option:selected").val();
        //var maxHeartbeatLost = $("#info-device-advanced-maxheartbeatlost").val();
       // var heartbeatInterval = $("#info-device-advanced-heartbeatinterval").val();
        //var heartbeatTimeout = $("#info-device-advanced-heartbeattimeout").val();
       // var resendLogin = $("#info-device-advanced-resendlogin").val();
        var mobileNumber = $("#info-mobilenumber").val();
        var model = $("#info-model option:selected").text();
        var modelId = $("#info-model option:selected").val();
        var serialNumber = $("#info-serial-number").val();
        var siteId = siteId;
        var businessState = $("#info-business-state option:selected").val();
        var siteName = siteName;
        var requestData = {
            "businessState": businessState,
            /*"config": {
                "timeout": timeout
               // "ackTimeout": ackTimeout,
               // "ackRetries": ackRetries,
                //"sync": sync
            },*/
            /*"deviceConfig": {
               // "maxHeartbeatLost": maxHeartbeatLost,
                "heartbeatInterval": heartbeatInterval
               // "heartbeatTimeout": heartbeatTimeout,
                //"resendLogin": resendLogin
            },*/
            "location": {
                "longitude": 116.407013,
                "latitude": 39.926588
            },
            "mobileNumber": mobileNumber,
            "model": model,
            "modelId": modelId,
            "name": name,
            "plcId": 0,
            "serialNumber": serialNumber,
            "siteId": siteId,
            "siteName": siteName
        };
        var emailList = $("#reContent").val();
        var hoursWarn = $("#info-device-hours").val();
        var warning1 = $("#info-device-warning").val();
        var warning2 = $("#info-warn-alarm").val();
        var warning3 = $("#info-device-serious").val();
        var requestData2 = {
            "emailList": emailList,
            "hoursWarn": hoursWarn,
            "warning1": warning1,
            "warning2": warning2,
            "warning3": warning3
        };
        if (serialNumber == "" || serialNumber == "undefined") { // 跳过网关配置
            gatewayMessage = "C";
        } else {
            if (id) { // 网关存在且没有绑定现场，执行编辑网关绑定现场
                $.ajax({
                    url: "/api/devices/" + id + "?verbose=100&access_token=" + sessionStorage.getItem("accessToken"),
                    type: "put",
                    async: false,
                    traditional: true,
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify(requestData),
                    success: function(data) {
                        if (typeof(data.result) != "undefined") {
                            if (data.result.name == name) {
                                $.ajax({
                                    url: "/api/alarmCfg/" + data.result._id + "/set?access_token=" + sessionStorage.getItem("accessToken"),
                                    type: "post",
                                    async: false,
                                    traditional: true,
                                    contentType: "application/json;charset=utf-8",
                                    data: JSON.stringify(requestData2),
                                    success: function(data2) {
                                        if (data2.result == "OK") {
                                            //传入设备
                                            gatewayMessage = "B";
                                            // submitDevice(siteId);
                                        }
                                    }
                                });
                            }
                        }
                    }
                });

            } else { // 添加网关信息，并绑定现场
                //根据序列号查询网关
                $.ajax({
                    url: "/api/devices?access_token=" + sessionStorage.getItem("accessToken"),
                    type: "post",
                    async: false,
                    traditional: true,
                    parameters: params,
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify(requestData),
                    success: function(data) {
                        if (typeof(data.result) != "undefined") {
                            if (data.result.name == name) {
                                $.ajax({
                                    url: "/api/alarmCfg/" + data.result._id + "/set?access_token=" + sessionStorage.getItem("accessToken"),
                                    type: "post",
                                    async: false,
                                    traditional: true,
                                    contentType: "application/json;charset=utf-8",
                                    data: JSON.stringify(requestData2),
                                    success: function(data2) {
                                        if (data2.result == "OK") {
                                            //传入设备
                                            gatewayMessage = "B";
                                            // submitDevice(siteId);
                                        }
                                    }
                                });
                            }
                        }
                    }
                });
            }
        }
    }

    //校验月流量预警字段
    function validate_warningnumber() {
        var warn = $("#info-device-warning").val();
        var ala = $("#info-warn-alarm").val();
        var ser = $("#info-device-serious").val();
        $("#warningseTips11,#warningseTips22,#warningseTips33").hide();
        if(warn != "" && ala != ""){
            if (parseFloat(warn) >= parseFloat(ala)) {
                $("#warningseTips11").show();
                return -1;
            } else {
                $("#warningseTips11").hide();
            }
        }else{
            $("#warningseTips11").hide();
        }
        if (warn != "" && ser != "") {
            if (parseFloat(warn) >= parseFloat(ser)) {
                $("#warningseTips33").show();
                return -1;
            } else {
                $("#warningseTips33").hide();
            }
        } else {
            $("#warningseTips33").hide();
        }
        if (ser != "" && ala != "") {
            if (parseFloat(ala) >= parseFloat(ser)) {
                $("#warningseTips22").show();
                return -1;
            } else {
                $("#warningseTips22").hide();
            }
        } else {
            $("#warningseTips22").hide();
        }
        return 1;
    }

    $("#info-device-warning,#info-warn-alarm,#info-device-serious").on("blur",function () {
        validate_warningnumber();
    });

    //解绑
    $("#gatewayId_i").click(function() {
        dialog.render({
            lang: "affirm_unbound",
            buttons: [{
                lang: "yes",
                click: function() {
                    var id = $("#isBindGatewayFlag").val();
                    jiebang(id, {
                        verbose: 1,
                        cancel_site: 1,
                    }, {
                        siteName: "",
                        siteId: null
                    }, function(data) {
                        if (typeof(data.result) != "undefined") {
                            if (data.result._id == id) {
                                $(".gateway_div").hide();
                                $("#add_edit_form").click();
                                $("#div_ip").empty();
                                $("#div_base").empty();
                                $("#div_signal").empty();
                                $("#div_ip").remove();
                                $("#div_base").remove();
                                $("#div_signal").remove();
                                $("#info-serial-number").removeAttr("readonly");
                                $("#isBindGatewayFlag").val("");
                                $("#isboundDiv").hide();
                                $("#info-serial-number").val("");
                            }
                        }
                        locale.render({
                            element: "#init_body"
                        });
                    }, this);
                    dialog.close();
                }
            }, {
                lang: "no",
                click: function() {
                    dialog.close();
                }
            }],
            close: function() {
                dialog.close();
            }
        });
    });

    //上一步
    $("#AddPreStep1").click(function(event) {
        $("#two_div").removeClass("finished").addClass("todo");
        $("#two_div").find("label span:eq(1)").removeClass("label");
        $("#two").empty().append("2");
        $("#first_div").removeClass("current").addClass("finished");
        $("#first_div").find("label span:eq(1)").addClass("label");
        $("#first").empty().append("1");
        $(".addGatewayContentBox").hide();
        $(".addSiteContentBox").show();
    });

    // 下一步
    $("#saveGatewayNextStep").click(function(event) {
        if(validate_warningnumber() < 0){
            return;
        }
        var serialNumber = $("#info-serial-number").val();
        var oldserialNumber = $("#oldinfo-serial-number").val();
        var name = $("#name").val()
        var oldGatewayName = $("#oldGateName").val();
        if (serialNumber == "") { //跳过网关配置
            $(".addGatewayContentBox").hide();
            $(".addDeviceContentBox").show();
            $("#two_div").removeClass("finished").addClass("current");
            // $("#two_div").find("label span:eq(1)").removeClass("label");
            $("#two").empty().append('<span class="glyphicon glyphicon-ok"></span> ');
            $("#three_div").removeClass("todo").addClass("finished");
            $("#three_div").find("label span:eq(1)").addClass("label");
        } else {
            if ($('#add_edit_form').validationEngine('validate')) {
                if (oldserialNumber != serialNumber) {
                    var flag = false;
                    var params = {
                        "verbose": 100,
                        "serial_number": serialNumber
                    };
                    searchGateway(false, params, function(data) {
                        if (typeof(data.result) != "undefined" && data.result.length > 0) {
                            if (data.result[0].siteName) {
                                flag = true;
                            }
                        }
                    }, this);
                    if (flag) {
                        $("#gatewaySerialtest").show();
                        return;
                    } else {
                        $("#gatewaySerialtest").hide();
                    }
                }
                if (name != oldGatewayName) {
                    var flag = false;
                    var params = {
                        "verbose": 100,
                        "name": name
                    };
                    searchGateway(false, params, function(data) {
                        if (data.result) {
                            for (var i = 0; i < data.result.length; i++) {
                                if (data.result[i].name == name) {
                                    flag = true;
                                    break;
                                }
                            }
                        }
                    }, this);
                    if (flag) {
                        $("#gatewayNametest").show();
                        return;
                    } else {
                        $("#gatewayNametest").hide();
                    }
                }
                $(".addGatewayContentBox").hide();
                $(".addDeviceContentBox").show();
                $("#two_div").removeClass("finished").addClass("current");
                $("#two").empty().append('<span class="glyphicon glyphicon-ok"></span> ');
                $("#three_div").removeClass("todo").addClass("finished");
                $("#three_div").find("label span:eq(1)").addClass("label");
            }
        }
    });
</script>