<style>
    #tableHead_selectAll {
        cursor: pointer;
    }

    #tableHead_selectAll:hover {
        color: #1fc651;
    }
    .module-info-role-items{
        margin: 10px 0 0 20px;
        border: 1px solid #D0D0D0;
        padding: 5px 0 10px 35px;
        position: relative;
        border-radius: 3px;
        width: 210px;
        display:inline-table;
    }
    .module-info-role-items-text{
        background-color: rgb(255, 255, 255);
        padding: 0 8px 0 8px;
        position: absolute;
        height: 15px;
        line-height: 16px;
        top: -8px;
        left: 3px;
    }
    .module-info-role-item{
        margin-top: 10px;
        height: 10px;
        line-height: 10px;
    }
</style>

<script type="text/javascript">
    //验证配置
    validator.render("#form_increseRole", {
        promptPosition: "inline",
        scroll: false
    });
    validator.render("#form_editRole", {
        promptPosition: "inline",
        scroll: false
    });

    //验证角色名是否存在
    function roleNameExist(field, rules, i, options) {
        var name = $.trim(field[0].value);
        if(!/^[a-zA-Z0-9_\-\u4e00-\u9fa5]+$/i.test(name)) {
            $("#searchInput").focus();
            return;
        }
        if (name != '') {
            var params = {verbose:1,name:name};
            var total;
            serachRole(params, false, function(data) {
                total = data.total;
            }, this);
            if (parseInt(total) > 0) {
                var message = locale.get("role_name_exist");
                return message;
            }
        }

    }
    //验证角色名是否存在
    function roleNameExist2(field, rules, i, options) {
        var oldName = $.trim($("#edit_oldRoleName").val());
        var name = $.trim(field[0].value);
        if(!/^[a-zA-Z0-9_\-\u4e00-\u9fa5]+$/i.test(name)) {
            $("#searchInput").focus();
            return;
        }
        if (name != '') {
            if(name!=oldName) {
                var params = {verbose:1,name:name};
                var total;
                serachRole(params, false, function(data) {
                    total = data.total;
                }, this);
                if (parseInt(total) > 0) {
                    var message = locale.get("role_name_exist");
                    return message;
                }
            }
        }

    }
    //初始化加载所有角色信息
    function init_load_roles(cursor,limit) {
        loading();
        $("#tableHead_checkbok").prop("checked", false);
        var params = {limit:limit,cursor:cursor};
        var params2 = {limit:limit,verbose:100};
        var requestData = {};
        getListRoleIds(params,function(data){//获取所有角色id
            if(data.total>0) {
                if(typeof(data.result)!="undefined"){
                    var ids = [];
                    for(var i = 0; i<data.result.length;i++) {
                        ids.push(data.result[i]._id);
                    }
                    requestData.resourceIds = ids;
                    getListRoleInfo(params2,requestData,function(data){//获取所有角色信息
                        if(data.total>0) {
                            fill_Roles(data.result);
                            renderPagination(data, init_load_roles);
                        }else {
                            clearPagination();
                            $("#panelContent").empty();
                            $("#panelContent").append('<tr><td colspan="11"  align="center" lang="text:no_data"></td></tr>');
                            locale.render({element: "#init_body"});
                        }
                    },this);
                }
            }else {
                clearPagination();
                $("#panelContent").empty();
                $("#panelContent").append('<tr><td colspan="11"  align="center" lang="text:no_data"></td></tr>');
                locale.render({element: "#init_body"});
            }
        },this);
    }

    //填充角色数据到列表中
    function fill_Roles(data){
        $("#panelContent").empty();
        var str;
        var name;
        for (var i = 0; i < data.length; i++) {
            name=typeof(data[i].name)=='undefined' ? "" : data[i].name;
            if(name=="admin") {
                name = locale.get("dn_admin");
            }else if(name=="DeviceManager") {
                name = locale.get("device_manager");
            }else if(name=="DeviceSense") {
                name = locale.get("device_sense");
            }
            str = "<tr>" ;
            if(data[i].system) {
                str +=  "<td style='width:1%;'><span class='glyphicon glyphicon-ban-circle link-black'></td>" ;
            }else {
                str +=  "<td style='width:1%;'><input type='checkbox' value='" + data[i]._id + "' class='tabs-checked'></td>" ;
            }
            str += "<td style='word-break: break-all;width:30%;'>" + name + "</td>" +
                "<td style='width:30%;'>" + transform_userCreateTime(data[i].createTime) + "</td>" +
                "<td style='width:30%;'>" + transform_userCreateTime(data[i].updateTime) + "</td>" +
                "<td style='text-align:center;width:9%;'>" +
                "<span data-toggle='tooltip'  lang='title:edit' data-permissionFilter='[6]'" +
                "onclick='showModel_edit_role(\"" + data[i]._id + "\")' style='padding: 3px 6px;'><span class='glyphicon glyphicon-edit link-black' aria-hidden='true' style=' cursor: pointer;'></span>&nbsp;</span>" +
                "</td>" +
                "</tr>";
            $("#panelContent").append(str);
        }
        //给input添加onclick事件
        $("tbody > tr > td > input").on("click", function() {
            var selected_rolesId = $("#panelContent tr td input[type='checkbox']:checked");
            var allUsers_nowPage = $("#panelContent tr td input");
            if (selected_rolesId.length < allUsers_nowPage.length) {
                $("#tableHead_checkbok").prop("checked", false);
            }
            if (selected_rolesId.length == allUsers_nowPage.length) {
                $("#tableHead_checkbok").prop("checked", true);
            }
        });
        permissionFilter_pageFunc();
        locale.render({element: "#init_body"});
        unload();
    }

    //每页显示条目切换回调函数
    function changePageNumber(limit) {
        init_load_roles(0, limit);
    }

    //跳转到指定页  回调函数
    function jumpTopage(cursor) {
        init_load_roles(cursor, $("#pageNumberSelect").val());
    }

    //定义工具
    function transform_userCreateTime(timestamp) {
        var date = new Date(timestamp * 1000);
        var month=(parseInt(date.getMonth() + 1)<10) ? ("0"+(date.getMonth() + 1)) : (date.getMonth() + 1) ;
        var day=(parseInt(date.getDate())<10) ? ("0"+date.getDate()) : date.getDate() ;
        var hour=(parseInt(date.getHours())<10) ? ("0"+date.getHours()) : date.getHours() ;
        var minutes=(parseInt(date.getMinutes())<10) ? ("0"+date.getMinutes()) : date.getMinutes() ;
        var seconds=(parseInt(date.getSeconds())<10) ? ("0"+date.getSeconds()) : date.getSeconds() ;
        var formatDate;
        formatDate = date.getFullYear() + '-' + month + '-' + day + ' ' + hour + ':' + minutes + ':' + seconds;
        return formatDate;
    }

    //当页全选
    $("#tableHead_selectAll").on('click', function(event) {
        var selected = $("#panelContent tr td input[type='checkbox']:checked");
        var allSiteCurrentPage = $("#panelContent tr td input");
        if (allSiteCurrentPage.length > 0) {
            if (selected.length < allSiteCurrentPage.length) {
                $("#panelContent tr td input").prop("checked", true);
                $("#tableHead_checkbok").prop("checked", true);
            } else {
                $("#panelContent tr td input").prop("checked", false);
                $("#tableHead_checkbok").prop("checked", false);
            }
        }
    });

</script>

<section class="content-header">
    <h1 lang="text:role">
        <small>Version 2.0</small>
    </h1>
    <ol class="breadcrumb">
        <li><a href="#" lang="text:system"></a></li>
        <li class="active" lang="text:role"> </li>
    </ol>
</section>

<section class="content" id="tcontent">
    <!-- Tab panes -->
    <div class="tab-content">
        <!--表格数据区-->
        <div class=" tab-pane row active">
            <div class="col-md-12">
                <div class="box">
                    <!--加载数据等待-->
                    <div class="overlay" style="display: none;">
                        <i class="fa icon-refresh icon-spin"></i>
                    </div>
                    <div class="box-header with-border">
                        <span><h3 class="box-title" lang="text:role_info">&nbsp;</h3></span>
                        <div class="box-tools pull-right">
                            <button class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip" title="Collapse"><i class="icon-minus fa-minus"></i></button>
                        </div>
                    </div>

                    <div class="box-body">
                        <div class="row">
                            <div class="col-sm-12" style="padding-bottom: 10px;"><!--查询条件-->
                                <form class="form-inline">
                                    <div class="box-tools pull-right">
                                        <div class="btn-group">
                                            <button type="button" class="btn btn-default btn-sm"  data-permissionFilter="[8]"
                                                    data-toggle='tooltip' data-placement="bottom" lang="title:add" onclick="showModel_increase_role();">
                                                <i class="glyphicon glyphicon-plus"></i>
                                            </button>
                                            <button type="button" class="btn btn-default btn-sm"  data-permissionFilter="[8]"
                                                    data-toggle='tooltip' data-placement="bottom" lang="title:delete" onclick="delete_roles();">
                                                <i class="iconfont icon-delete"></i>
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div>
                            <table class="table table-bordered table-hover table-striped">
                                <thead>
                                <tr>
                                    <th id="tableHead_selectAll" style="width:1%;">
                                        <input type="checkbox" id="tableHead_checkbok" data-toggle='tooltip' data-placement="bottom" lang="title:check_all">
                                    </th>
                                    <th lang="text:role_name1" ></th>
                                    <th lang="text:create_time" style="width:30%;"></th>
                                    <th lang="text:update_time" style="width:30%;"></th>
                                    <th lang="text:operate" style="text-align: center;width:60px;"></th>
                                </tr>
                                </thead>
                                <tbody id="panelContent">

                                <!--动态载入数据-->

                                </tbody>
                            </table>
                        </div>
                    </div><!--box-body-->
                    <div id="page-footer">
                    </div>
                </div>
            </div>
        </div>

    </div>
</section>

<!--新增角色模态框-->
<div class="modal fade" id="model_increseRole">
    <div class="modal-dialog">
        <div class="modal-content" style="width:720px;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="clear_validationInfo()">
                    <span aria-hidden="true">×</span></button>
                <h4 id="modal_title1" class="modal-title" lang="text:add_role"></h4>
            </div>
            <div class="modal-body div_body">
                <form class="form-horizontal" id="form_increseRole">
                    <input type="reset" id="reset_increse" style="display:none;"/>
                    <div class="form-group">
                        <label class="col-sm-2 control-label" style="text-align:left;"><span lang="text:role_name1"></span ><span class="text-red">*</span></label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control validate[required,custom[stopSpecialCharacters],maxSize[30],funcCall[roleNameExist]" name="name" id="model_increseRole_roleName"
                                   lang="placeholder:role_name1">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label" style="text-align:left;" lang="text:role_type"></label>
                        <div class="col-sm-10">
                            <span style="display: inline-block; margin-top: 7px;" id="model_increseRole_Type" class="module-info-role-type-value" xtype="52" lang="text:user_defined_role"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label" style="text-align:left;" lang="text:empower"></label>
                    </div>
                    <div class="row" id="privileges_select" style="width: 680px;">
                        <div class="form-group">
                            <div class="col-md-4">
                                <div class="module-info-role-items " style="height:117px;"><!--设备管理-->
                                    <div class="module-info-role-items-text">
                                        <input id="50" type="checkbox" group="5" number="0" >
                                        <span for="50" lang="text:device_manage" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input id="51" type="checkbox" group="5" number="1" >
                                        <span for="51" lang="text:see_device" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="5" number="2" id="52">
                                        <span for="52" lang="text:create_update" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="5" number="3" id="53">
                                        <span for="53" lang="text:part_create_update" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="5" number="4" id="54">
                                        <span for="54" lang="text:part_maintain" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                </div><!--设备管理-->
                            </div>
                            <div class="col-md-4">
                                <div class="module-info-role-items "><!--维修管理-->
                                    <div class="module-info-role-items-text">
                                        <input id="60" type="checkbox" group="6" number="0" >
                                        <span for="60" lang="text:repair_manage" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input id="61" type="checkbox" group="6" number="1" >
                                        <span for="61" lang="text:watch_order" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="6" number="2" id="62">
                                        <span for="62" lang="text:create_update_order" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="6" number="3" id="63">
                                        <span for="63" lang="text:watch_schedule" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="6" number="4" id="64">
                                        <span for="64" lang="text:create_update_schedule" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="6" number="5" id="65">
                                        <span for="65" lang="text:repair_processing" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                </div><!--维修管理-->
                            </div>
                            <div class="col-md-4">
                                <div class="module-info-role-items " style="height:117px;"><!--网络管理-->
                                    <div class="module-info-role-items-text">
                                        <input id="network-manage-button" type="checkbox" group="1" number="0" disabled="disabled" checked="checked">
                                        <span for="network-manage-button" lang="text:network_manage" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input id="network-manage-button-1" type="checkbox" group="1" number="1" disabled="disabled" checked="checked">
                                        <span for="network-manage-button-1" lang="text:scout" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="1" number="2" id="12">
                                        <span for="network-manage-button-2" lang="text:create_update" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="1" number="3" id="13">
                                        <span for="network-manage-button-3" lang="text:configure_upgrade" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="1" number="4" id="14">
                                        <span for="network-manage-button-4" lang="text:console" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                </div><!--网路管理-->
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-md-4">
                                <div class="module-info-role-items "><!--远程监控-->
                                    <div class="module-info-role-items-text">
                                        <input  type="checkbox" group="3" number="0" id="30">
                                        <span for="remote-control-button" lang="text:remote_monitoring" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="3" number="1" id="31">
                                        <span for="remote-control-button-1" lang="text:read_configuration_diagram" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="3" number="2" id="32">
                                        <span for="remote-control-button-2" lang="text:write_configuration_diagram" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="3" number="3" id="33">
                                        <span for="remote-control-button-3" lang="text:remote_control" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="3" number="4" id="34">
                                        <span for="remote-control-button-4" lang="text:business_report" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                </div><!--远程监控-->
                            </div>
                            <div class="col-md-4">
                                <div class="module-info-role-items " style="height:97px;"><!--告警处理-->
                                    <div class="module-info-role-items-text">
                                        <input  type="checkbox" group="4" number="0" id="40">
                                        <span for="alarm-processing-button" lang="text:alarm_processing" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="4" number="1" id="41">
                                        <span for="alarm-processing-button-1" lang="text:see_alarm" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="4" number="2" id="42">
                                        <span for="alarm-processing-button-2" lang="text:affirm_clear" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                </div><!--告警处理-->
                            </div>
                            <div class="col-md-4">
                                <div class="module-info-role-items" style="height:97px;"><!--远程维护-->
                                    <div class="module-info-role-items-text">
                                        <input  type="checkbox" group="2" number="0" id="20">
                                        <span for="remote-maintenance-button" lang="text:remote_maintenance" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="2" number="1" id="21">
                                        <span for="remote-maintenance-button-1" lang="text:allow" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                </div><!--远程维护-->
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer" >
                <button type="button" class="btn btn-default pull-left" data-dismiss="modal" id="increase_close" lang="text:close" onclick="clear_validationInfo()"></button>
                <button type="button" class="btn btn-primary" onclick="increase_role();" lang="text:submit" data-permissionFilter="[8]"></button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
    <script>
        //添加权限选择点击事件
        $("#privileges_select :checkbox").on("click",function (event) {
            var input=$(this);
            var id=input.attr("id");
            if(id%10 == 0){
                if(input.prop("checked")==true){
                    (input.parent().siblings().find("input")).prop("checked",true);
                    if($.inArray(id,["20","30"])>=0){
                        $("#12").prop("checked",true);
                    }
                }else{
                    (input.parent().siblings().find("input")).prop("checked",false);
                }
                if(id=="60") {
                    if(input.prop("checked")==true){
                        $("#50,#51,#54").prop("checked",true);
                    }
                }
            }else{
                /* 关联选项操作 */
                //网路管理块
                if($.inArray(id,["13","14"])>=0){
                    if(input.prop("checked")==true){
                        $("#12").prop("checked",true);
                    }
                }
                if($.inArray(id,["12"])>=0){
                    if(input.prop("checked")==false){
                        $("#13,#14,#20,#21,#33").prop("checked",false);
                        if(($("#30").parent().siblings().find("input[type='checkbox']:checked")).length<1){
                            $("#30").prop("checked",false);
                        }
                    }
                }
//                //远程维护块
                if($.inArray(id,["21"])>=0){
                    if(input.prop("checked")==true){
                        $("#12").prop("checked",true);
                    }
                }
//                //告警处理块
                if($.inArray(id,["42"])>=0){
                    if(input.prop("checked")==true){
                        $("#41").prop("checked",true);
                    }
                }
                if($.inArray(id,["41"])>=0){
                    if(input.prop("checked")==false){
                        $("#42").prop("checked",false);
                    }
                }
//                //远程监控块
                if($.inArray(input.attr("id"),["33"])>=0){
                    if(input.prop("checked")==true){
                        $("#12").prop("checked",true);
                    }
                }
                if($.inArray(id,["32"])>=0){
                    if(input.prop("checked")==true){
                        $("#31").prop("checked",true);
                    }
                }
                if($.inArray(id,["31"])>=0){
                    if(input.prop("checked")==false){
                        $("#32").prop("checked",false);
                    }
                }

                //维修块

                //维修管理
                if($.inArray(id,["61"])>=0){
                    if(input.prop("checked")==false){
                        $("#62,#65").prop("checked",false);
                    }
                }
                if($.inArray(id,["63"])>=0){
                    if(input.prop("checked")==false){
                        $("#64").prop("checked",false);
                    }
                }
                if($.inArray(id,["65"])>=0){
                    if(input.prop("checked")==true){
                        $("#61,#62,#51,#54,#50").prop("checked",true);
                    }
                }
                if($.inArray(id,["62"])>=0){
                    if(input.prop("checked")==true){
                        $("#61,#51,#50").prop("checked",true);
                    } else {
                        $("#65").prop("checked",false);
                    }
                }
                if($.inArray(id,["64"])>=0){
                    if(input.prop("checked")==true){
                        $("#63,#51,#50").prop("checked",true);
                    }
                }
                //设备管理块
                if($.inArray(id,["52","53","54"])>=0){
                    if(input.prop("checked")==true){
                        $("#51").prop("checked",true);
                    }
                }
                if($.inArray(id,["51"])>=0){
                    if(input.prop("checked")==false){
                        $("#52,#53,#54,#62,#64,#65").prop("checked",false);
                    }
                }
                if($.inArray(id,["54"])>=0){
                    if(input.prop("checked")==false){
                        $("#65").prop("checked",false);
                    }
                }

                //checked 当前块被选中的元素集合
                var checked=input.parent().parent().find("input").filter(function (index) {
                    var sym=false;
                    if(index>0 && $(this).prop("checked")==true){
                        sym=true
                    }
                    return sym;
                });
                if(checked.length <= 0){
                    input.parent().parent().find(":checkbox").first().prop("checked",false);
                }else{
                    input.parent().parent().find(":checkbox").first().prop("checked",true);
                }
            }
        });
    </script>
</div><!-- /.modal -->

<!--修改角色信息模态框-->
<div class="modal fade" id="model_editRole">
    <div class="modal-dialog">
        <div class="modal-content" style="width:720px;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="clear_validationInfo()">
                    <span aria-hidden="true">×</span></button>
                <h4 id="modal_title" class="modal-title" lang="text:edit_role"></h4>
            </div>
            <div class="modal-body div_body">
                <form class="form-horizontal" id="form_editRole">
                    <input type="reset" id="reset_edit" style="display:none;"/>
                    <input type="hidden" id="edit_roleId" value=""/>
                    <input type="hidden" id="edit_oldRoleName" value=""/>
                    <div class="form-group">
                        <label class="col-sm-2 control-label" style="text-align:left;" ><span lang="text:role_name1"></span ><span class="text-red">*</span></label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control validate[required,custom[stopSpecialCharacters],maxSize[30]],funcCall[roleNameExist2]" name="name" id="edit_roleName"
                                   lang="placeholder:role_name1">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label" style="text-align:left;" lang="text:role_type"></label>
                        <div class="col-sm-10">
                            <span style="display: inline-block; margin-top: 7px;" id="edit_roleType" class="module-info-role-type-value"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label" style="text-align:left;" lang="text:empower"></label>
                    </div>
                    <div  class="row" id="edit_privileges" style="width: 685px;">
                        <div class="form-group" id="first_form_group">
                            <div class="col-md-4"  id="system_manage_div">
                                <div  class="module-info-role-items " style="height: 117px;"><!--系统管理-->
                                    <div class="module-info-role-items-text">
                                        <input  type="checkbox" group="0" number="0" id="edit_00" disabled="disabled" checked="checked">
                                        <span for="remote-maintenance-button" lang="text:system_manage"  style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="0" number="1" id="edit_01" disabled="disabled" checked="checked">
                                        <span for="remote-maintenance-button-1" lang="text:user_manage"  style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="0" number="2" id="edit_02" disabled="disabled" checked="checked" >
                                        <span for="remote-maintenance-button-1" lang="text:role_manage" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="0" number="3" id="edit_03" disabled="disabled" checked="checked">
                                        <span for="remote-maintenance-button-1" lang="text:authority_manage"  style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="0" number="4" id="edit_04" disabled="disabled" checked="checked">
                                        <span for="remote-maintenance-button-1" lang="text:config"  style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                </div><!--系统管理-->
                            </div>
                            <div class="col-md-4" >
                                <div class="module-info-role-items" style="height: 117px;"><!--设备管理-->
                                    <div class="module-info-role-items-text">
                                        <input id="edit_50" type="checkbox" group="5" number="0" >
                                        <span for="edit_50" lang="text:device_manage" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input id="edit_51" type="checkbox" group="5" number="1" >
                                        <span for="edit_51" lang="text:see_device" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="5" number="2" id="edit_52">
                                        <span for="edit_52" lang="text:create_update" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="5" number="3" id="edit_53">
                                        <span for="edit_53" lang="text:part_create_update" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="5" number="4" id="edit_54">
                                        <span for="edit_54" lang="text:part_maintain" style="color: rgb(0, 0, 0);"></span>
                                    </div>

                                </div><!--设备管理-->
                            </div>
                            <div class="col-md-4">
                                <div class="module-info-role-items "><!--维修管理-->
                                    <div class="module-info-role-items-text">
                                        <input id="edit_60" type="checkbox" group="6" number="0" >
                                        <span for="edit_60" lang="text:repair_manage" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input id="edit_61" type="checkbox" group="6" number="1" >
                                        <span for="edit_61" lang="text:watch_order" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="6" number="2" id="edit_62">
                                        <span for="edit_62" lang="text:create_update_order" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="6" number="3" id="edit_63">
                                        <span for="edit_63" lang="text:watch_schedule" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="6" number="4" id="edit_64">
                                        <span for="edit_64" lang="text:create_update_schedule" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="6" number="5" id="edit_65">
                                        <span for="edit_65" lang="text:repair_processing" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                </div><!--维修管理-->
                            </div>
                        </div>
                        <div class="form-group" id="two_form_group">
                            <div class="col-md-4" id="network_mangement_div">
                                <div class="module-info-role-items "><!--网络管理-->
                                    <div class="module-info-role-items-text">
                                        <input type="checkbox" group="1" number="0" id="edit_10" disabled="disabled" checked="checked">
                                        <span for="network-manage-button" lang="text:network_manage" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="1" number="1" id="edit_11" disabled="disabled" checked="checked">
                                        <span for="network-manage-button-1" lang="text:scout" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="1" number="2" id="edit_12">
                                        <span for="network-manage-button-2" lang="text:create_update" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="1" number="3" id="edit_13">
                                        <span for="network-manage-button-3" lang="text:configure_upgrade" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="1" number="4" id="edit_14">
                                        <span for="network-manage-button-4" lang="text:console" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                </div><!--网络管理-->
                            </div>
                            <div class="col-md-4">
                                <div class="module-info-role-items "><!--远程监控-->
                                    <div class="module-info-role-items-text">
                                        <input  type="checkbox" group="3" number="0" id="edit_30">
                                        <span for="remote-control-button" lang="text:remote_monitoring" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="3" number="1" id="edit_31">
                                        <span for="remote-control-button-1" lang="text:read_configuration_diagram" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input type="checkbox" group="3" number="2" id="edit_32">
                                        <span for="remote-control-button-2" lang="text:write_configuration_diagram" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="3" number="3" id="edit_33">
                                        <span for="remote-control-button-3" lang="text:remote_control" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input type="checkbox" group="3" number="4" id="edit_34">
                                        <span for="remote-control-button-4" lang="text:business_report" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                </div><!--远程监控-->
                            </div>
                            <div class="col-md-4">
                                <div class="module-info-role-items " style="height:97px;"><!--告警处理-->
                                    <div class="module-info-role-items-text">
                                        <input  type="checkbox" group="4" number="0" id="edit_40">
                                        <span for="alarm-processing-button" lang="text:alarm_processing" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="4" number="1" id="edit_41">
                                        <span for="alarm-processing-button-1" lang="text:see_alarm" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="4" number="2" id="edit_42">
                                        <span for="alarm-processing-button-2" lang="text:affirm_clear" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                </div><!--告警处理-->
                            </div>
                        </div>
                        <div class="form-group" id="three_form_group">
                            <div class="col-md-4">
                                <div class="module-info-role-items"><!--远程维护-->
                                    <div class="module-info-role-items-text">
                                        <input  type="checkbox" group="2" number="0" id="edit_20">
                                        <span for="remote-maintenance-button" lang="text:remote_maintenance" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                    <div class="module-info-role-item">
                                        <input  type="checkbox" group="2" number="1" id="edit_21">
                                        <span for="remote-maintenance-button-1" lang="text:allow" style="color: rgb(0, 0, 0);"></span>
                                    </div>
                                </div><!--远程维护-->
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default pull-left" id="edit_close" data-dismiss="modal" lang="text:close" onclick="clear_validationInfo()"></button>
                <button type="button" class="btn btn-primary" onclick="edit_role();" id="edit_submit" lang="text:submit" data-permissionFilter="[8]"></button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
    <script>
        $("#edit_privileges :checkbox").on("click",function (event) {
            var input=$(this);
            var id=input.attr("id");
            var id2 = id.substring(5,id.length);
            if(id2%10 == 0){
                if(input.prop("checked")==true){
                    (input.parent().siblings().find("input")).prop("checked",true);
                    if($.inArray(id,["edit_20","edit_30"])>=0){
                        $("#edit_12").prop("checked",true);
                    }
                }else{
                    (input.parent().siblings().find("input")).prop("checked",false);
                }
                if(id=="edit_60") {
                    if(input.prop("checked")==true){
                        $("#edit_50,#edit_51,#edit_54").prop("checked",true);
                    }
                }
            }else{
                /* 关联选项操作 */
                //网路管理块
                if($.inArray(id,["edit_13","edit_14"])>=0){
                    if(input.prop("checked")==true){
                        $("#edit_12").prop("checked",true);
                    }
                }
                if($.inArray(id,["edit_12"])>=0){
                    if(input.prop("checked")==false){
                        $("#edit_13,#edit_14,#edit_20,#edit_21,#edit_33").prop("checked",false);
                        if(($("#edit_30").parent().siblings().find("input[type='checkbox']:checked")).length<1){
                            $("#edit_30").prop("checked",false);
                        }
                    }
                }
//                //远程维护块
                if($.inArray(id,["edit_21"])>=0){
                    if(input.prop("checked")==true){
                        $("#edit_12").prop("checked",true);
                    }
                }
//                //告警处理块
                if($.inArray(id,["edit_42"])>=0){
                    if(input.prop("checked")==true){
                        $("#edit_41").prop("checked",true);
                    }
                }
                if($.inArray(id,["edit_41"])>=0){
                    if(input.prop("checked")==false){
                        $("#edit_42").prop("checked",false);
                    }
                }
//                //远程监控块
                if($.inArray(input.attr("id"),["edit_33"])>=0){
                    if(input.prop("checked")==true){
                        $("#edit_12").prop("checked",true);
                    }
                }
                if($.inArray(id,["edit_32"])>=0){
                    if(input.prop("checked")==true){
                        $("#edit_31").prop("checked",true);
                    }
                }
                if($.inArray(id,["edit_31"])>=0){
                    if(input.prop("checked")==false){
                        $("#edit_32").prop("checked",false);
                    }
                }

                //维修块

                //维修管理
                if($.inArray(id,["edit_61"])>=0){
                    if(input.prop("checked")==false){
                        $("#edit_62,#edit_65").prop("checked",false);
                    }
                }
                if($.inArray(id,["edit_63"])>=0){
                    if(input.prop("checked")==false){
                        $("#edit_64").prop("checked",false);
                    }
                }
                if($.inArray(id,["edit_65"])>=0){
                    if(input.prop("checked")==true){
                        $("#edit_61,#edit_62,#edit_51,#edit_54,#edit_50").prop("checked",true);
                    }
                }
                if($.inArray(id,["edit_62"])>=0){
                    if(input.prop("checked")==true){
                        $("#edit_61,#edit_51,#edit_50").prop("checked",true);
                    }else {
                        $("#edit_65").prop("checked",false);
                    }
                }
                if($.inArray(id,["edit_64"])>=0){
                    if(input.prop("checked")==true){
                        $("#edit_63,#edit_51,#edit_50").prop("checked",true);
                    }
                }
                //设备管理块
                if($.inArray(id,["edit_52","edit_53","edit_54"])>=0){
                    if(input.prop("checked")==true){
                        $("#edit_51").prop("checked",true);
                    }
                }

                if($.inArray(id,["edit_51"])>=0){
                    if(input.prop("checked")==false){
                        $("#edit_52,#edit_53,#edit_54,#edit_62,#edit_64,#edit_65").prop("checked",false);
                    }
                }
                if($.inArray(id,["edit_54"])>=0){
                    if(input.prop("checked")==false){
                        $("#edit_65").prop("checked",false);
                    }
                }

                //checked 当前块被选中的元素集合
                var checked=input.parent().parent().find("input").filter(function (index) {
                    var sym=false;
                    if(index>0 && $(this).prop("checked")==true){
                        sym=true
                    }
                    return sym;
                });
                if(checked.length <= 0){
                    input.parent().parent().find(":checkbox").first().prop("checked",false);
                }else{
                    input.parent().parent().find(":checkbox").first().prop("checked",true);
                }
            }
        });
    </script>
</div><!-- /.modal -->

<script type="text/javascript">
    //显示添加角色模态框
    //显示添加角色模态框
    function showModel_increase_role() {
        $('#model_increseRole').modal('show');
        $('#reset_increse').click();
        $(".formErrorContent").remove();
    }

    //显示编辑角色模态框
    function showModel_edit_role(_id) {
        $('#model_editRole').modal('show');
        $('#reset_edit').click();
        $("#system_manage_div").hide();
        $("#edit_privileges input[type='checkbox']").prop("checked","");
        $(".formErrorContent").remove();
        //获取角色信息
        getRoleInfo(_id,function(data){
            if(typeof(data.result)!="undefined"){
                fill_roleInfo(data.result);
            }
        },this);
    }

    //回填角色信息
    function fill_roleInfo(data) {
        $("#edit_roleId").val(data._id);
        var name = data.name;
        if(name=="admin") {
            name = locale.get("dn_admin");
        }else if(name=="DeviceManager") {
            name = locale.get("device_manager");
        }else if(name=="DeviceSense") {
            name = locale.get("device_sense");
        }
        $("#edit_roleName").val(name);
        $("#edit_oldRoleName").val(data.name);
        var accept = data.privileges.accept;
        if(data.system==true) {
            //系统角色
            $("#edit_roleType").attr("xtype",data.type);
            $("#edit_roleType").prop("lang","text:system_role");
            $("#edit_privileges input[type='checkbox']").prop("disabled","disabled");
            $("#edit_submit").hide();
            $("#edit_roleName").prop("disabled","disabled");
            if(data.type==51){
                $("#system_manage_div").show();
                if($("#first_form_group > div:eq(3)")) {
                    var $divs = $("#two_form_group > div");
                    $("#two_form_group").append($("#first_form_group > div:eq(3)").detach()).append($divs);
                    $("#network_mangement_div > div").css("height","97px");
                }
                if($("#two_form_group > div:eq(3)")) {
                    $("#three_form_group").append($("#two_form_group > div:eq(3)").detach());
                    $("#three_form_group > div > div").css("height","44px");
                }
            }else {
                $("#first_form_group").append($("#network_mangement_div").detach());
                $("#network_mangement_div > div").css("height","117px");
                $("#two_form_group").append($("#three_form_group > div").detach());
                $("#two_form_group > div:last > div").css("height","97px");
            }
        }else {
            //用户自定义j角色
            $("#edit_privileges input[type='checkbox']").prop("disabled","");
            $("#edit_10").prop("disabled","disabled");
            $("#edit_11").prop("disabled","disabled");
            $("#edit_10").prop("checked","checked");
            $("#edit_11").prop("checked","checked");
            $("#edit_roleType").prop("lang","text:user_defined_role");
            $("#edit_roleType").attr("xtype",data.type);
            $("#first_form_group").append($("#network_mangement_div").detach());
            $("#network_mangement_div > div").css("height","117px");
            $("#two_form_group").append($("#three_form_group > div").detach());
            $("#two_form_group > div:last > div").css("height","97px");
        }
        //权限回填
        if(data.privileges.default=="all") {
            //回填所有权限
            $("#edit_privileges input[type='checkbox']").prop("checked","checked");
        }else {
            if($.inArray(12,accept)!=-1) {
                //创建更改
                $("#edit_12").prop("checked","checked");
            }
            if($.inArray(21,accept)!=-1) {
                //配置升级
                $("#edit_13").prop("checked","checked");
            }
            if($.inArray(456,accept)!=-1) {
                //控制台
                $("#edit_14").prop("checked","checked");
            }
            if($.inArray(53,accept)!=-1) {
                //允许
                $("#edit_21").prop("checked","checked");
            }
            if($.inArray(91,accept)!=-1) {
                //组态图查看
                $("#edit_31").prop("checked","checked");
            }
            if($.inArray(92,accept)!=-1) {
                //组态图编辑
                $("#edit_32").prop("checked","checked");
            }
            if($.inArray(457,accept)!=-1) {
                //远程控制
                $("#edit_33").prop("checked","checked");
            }
            if($.inArray(73,accept)!=-1) {
                //查看业务报表
                $("#edit_34").prop("checked","checked");
            }
            if($.inArray(49,accept)!=-1) {
                // 查看
                $("#edit_41").prop("checked","checked");
            }
            if($.inArray(50,accept)!=-1) {
                //确认、清除
                $("#edit_42").prop("checked","checked");
            }
            if($.inArray(201,accept)!=-1) {
                //查看
                $("#edit_50").prop("checked","checked");
                $("#edit_51").prop("checked","checked");
            }
            if($.inArray(202,accept)!=-1) {
                //设备创建、更改
                $("#edit_50").prop("checked","checked");
                $("#edit_51").prop("checked","checked");
                $("#edit_52").prop("checked","checked");
            }
            if($.inArray(204,accept)!=-1) {
                //部件创建、更改
                $("#edit_50").prop("checked","checked");
                $("#edit_51").prop("checked","checked");
                $("#edit_53").prop("checked","checked");
            }
            if($.inArray(206,accept)!=-1) {
                //部件维护
                $("#edit_50").prop("checked","checked");
                $("#edit_51").prop("checked","checked");
                $("#edit_54").prop("checked","checked");
            }

            if($.inArray(215,accept)!=-1) {
                //查看工单
                $("#edit_60").prop("checked","checked");
                $("#edit_61").prop("checked","checked");
            }
            if($.inArray(214,accept)!=-1) {
                //工单创建、更改
                $("#edit_60").prop("checked","checked");
                $("#edit_61").prop("checked","checked");
                $("#edit_62").prop("checked","checked");
            }
            if($.inArray(213,accept)!=-1) {
                //查看预防性计划
                $("#edit_60").prop("checked","checked");
                $("#edit_63").prop("checked","checked");
            }
            if($.inArray(212,accept)!=-1) {
                //预防性计划创建、更改
                $("#edit_50").prop("checked","checked");
                $("#edit_51").prop("checked","checked");
                $("#edit_60").prop("checked","checked");
                $("#edit_63").prop("checked","checked");
                $("#edit_64").prop("checked","checked");
            }
            if($.inArray(216,accept)!=-1) {
                //维修处理
                $("#edit_50").prop("checked","checked");
                $("#edit_51").prop("checked","checked");
                $("#edit_54").prop("checked","checked");
                $("#edit_60").prop("checked","checked");
                $("#edit_61").prop("checked","checked");
                $("#edit_65").prop("checked","checked");
            }

        }
        if($("#edit_21").prop("checked")==true){
            $("#edit_20").prop("checked","checked");
        }
        if($("#edit_31").prop("checked")==true||$("#edit_32").prop("checked")==true||$("#edit_33").prop("checked")==true||$("#edit_34").prop("checked")==true){
            $("#edit_30").prop("checked","checked");
        }
        if($("#edit_41").prop("checked")==true||$("#edit_42").prop("checked")==true){
            $("#edit_40").prop("checked","checked");
        }
        locale.render({element: "#init_body"});
    }

    //添加角色
    function increase_role() {
        if ($('#form_increseRole').validationEngine('validate')) {
            $("#model_increseRole").hide();
            var name = $.trim($("#model_increseRole_roleName").val());
            var type = parseInt($("#model_increseRole_Type").attr("xtype"));
            var accept =[3,5, 11, 13, 15, 16, 19, 25, 26, 29, 39, 40, 41, 83, 84, 87, 88, 89, 101,211,301,302];//默认权值
            if($("#12").prop("checked")==true) {
                var arr = [12, 14, 28, 30, 38, 42,58,62 , 85, 90];
                accept = accept.concat(arr);
            }
            if($("#13").prop("checked")==true){
                var arr = [21, 22];
                accept = accept.concat(arr);
            }
            if($("#14").prop("checked")==true){
                var arr = [456];
                accept = accept.concat(arr);
            }
            if($("#21").prop("checked")==true){
                var arr = [53, 54, 55, 56];
                accept = accept.concat(arr);
            }
            if($("#31").prop("checked")==true){
                var arr = [91, 95, 97 ];
                accept = accept.concat(arr);
            }
            if($("#32").prop("checked")==true){
                var arr = [92, 96, 98];
                accept = accept.concat(arr);
            }
            if($("#33").prop("checked")==true){
                var arr = [457];
                accept = accept.concat(arr);
            }
            if($("#34").prop("checked")==true){
                var arr = [73, 81, 100, 103, 104];
                accept = accept.concat(arr);
            }
            if($("#41").prop("checked")==true){
                var arr = [49 ];
                accept = accept.concat(arr);
            }
            if($("#42").prop("checked")==true){
                var arr = [50];
                accept = accept.concat(arr);
            }
            if($("#51").prop("checked")==true){
                var arr = [201,203,205];
                accept = accept.concat(arr);
            }
            if($("#52").prop("checked")==true){
                var arr = [202];
                accept = accept.concat(arr);
            }
            if($("#53").prop("checked")==true){
                var arr = [204];
                accept = accept.concat(arr);
            }
            if($("#54").prop("checked")==true){
                var arr = [206];
                accept = accept.concat(arr);
            }
            if($("#61").prop("checked")==true){
                var arr = [215,217];
                accept = accept.concat(arr);
            }
            if($("#62").prop("checked")==true){
                var arr = [214];
                accept = accept.concat(arr);
            }
            if($("#63").prop("checked")==true){
                var arr = [213];
                accept = accept.concat(arr);
            }
            if($("#64").prop("checked")==true){
                var arr = [212];
                accept = accept.concat(arr);
            }
            if($("#65").prop("checked")==true){
                var arr = [216];
                accept = accept.concat(arr);
            }

            var privileges = {
                accept:accept,
                default:"none",
                deny:[]
            };
            var sendData = {
                name:name,
                type:type,
                privileges:privileges
            };
            createRole(sendData, function(data) {
                if(typeof(data.result)!="undefined") {
                    dialog.render({
                        lang:"submit_success",
                    });
                    $("#increase_close").click();
                    init_load_roles(0,parseInt($("#pageNumberSelect").val()));
                }else {
                    dialog.render({
                        lang:"submit_failed",
                    });
                }
                locale.render({element: "#init_body"});
            }, this);
        }
    }

    //删除角色
    function delete_roles() {
        var selected_roles = $("#panelContent tr td input[type='checkbox']:checked");
        if (selected_roles.length > 0) {
            dialog.render({
                lang: "deleteGatewayInfo",
                buttons: [{lang: "yes", click: function() {
                    selected_roles.each(function() {
                        deleteRole($(this).val(),function (data) {
                            if(data.error){
                                if(data.error_code == 20005){
                                    errorTipDis("cannot_delete_a_user_role")
                                    locale.render({element: "#init_body"});
                                }
                            }
                        },this);
                    });
                    init_load_roles(0,parseInt($("#pageNumberSelect").val()));
                    dialog.close();
                }}, {lang: "no", click: function() {
                    dialog.close();
                }}],
                close: function() {
                    dialog.close();
                }
            });
        } else {
            errorTipDis("select_del")
        }
        locale.render({element: "#init_body"});
    }

    //编辑角色
    function edit_role() {
        if ($('#form_editRole').validationEngine('validate')) {
            var id = $("#edit_roleId").val();
            var name = $.trim($("#edit_roleName").val());
            var type = parseInt($("#edit_roleType").attr("xtype"));
            var accept =[3,5, 11, 13, 15, 16, 19, 25, 26, 29, 39, 40, 41, 83, 84, 87, 88, 89, 101,211,301,302];//默认权值
            if($("#edit_12").prop("checked")==true) {
                var arr = [12, 14, 28, 30, 38, 42,  58,62 , 85,  90];
                accept = accept.concat(arr);
            }
            if($("#edit_13").prop("checked")==true){
                var arr = [21, 22];
                accept = accept.concat(arr);
            }
            if($("#edit_14").prop("checked")==true){
                var arr = [456];
                accept = accept.concat(arr);
            }
            if($("#edit_21").prop("checked")==true){
                var arr = [53, 54, 55, 56];
                accept = accept.concat(arr);
            }
            if($("#edit_31").prop("checked")==true){
                var arr = [91, 95, 97 ];
                accept = accept.concat(arr);
            }
            if($("#edit_32").prop("checked")==true){
                var arr = [92, 96, 98];
                accept = accept.concat(arr);
            }
            if($("#edit_33").prop("checked")==true){
                var arr = [457];
                accept = accept.concat(arr);
            }
            if($("#edit_34").prop("checked")==true){
                var arr = [73, 81, 100, 103, 104];
                accept = accept.concat(arr);
            }
            if($("#edit_41").prop("checked")==true){
                var arr = [49 ];
                accept = accept.concat(arr);
            }
            if($("#edit_42").prop("checked")==true){
                var arr = [50];
                accept = accept.concat(arr);
            }
            if($("#edit_51").prop("checked")==true){
                var arr = [201,203,205];
                accept = accept.concat(arr);
            }
            if($("#edit_52").prop("checked")==true){
                var arr = [202];
                accept = accept.concat(arr);
            }
            if($("#edit_53").prop("checked")==true){
                var arr = [204];
                accept = accept.concat(arr);
            }
            if($("#edit_54").prop("checked")==true){
                var arr = [206];
                accept = accept.concat(arr);
            }
            if($("#edit_61").prop("checked")==true){
                var arr = [215,217];
                accept = accept.concat(arr);
            }
            if($("#edit_62").prop("checked")==true){
                var arr = [214];
                accept = accept.concat(arr);
            }
            if($("#edit_63").prop("checked")==true){
                var arr = [213];
                accept = accept.concat(arr);
            }
            if($("#edit_64").prop("checked")==true){
                var arr = [212];
                accept = accept.concat(arr);
            }
            if($("#edit_65").prop("checked")==true){
                var arr = [216];
                accept = accept.concat(arr);
            }
            var privileges ={accept:accept,default:"none",deny:[]};
            var sendData = {name:name,type:type,privileges:privileges};
            editRole(id,sendData, function(data) {
                if(typeof(data.result)!="undefined") {
                    dialog.render({
                        lang:"submit_success",
                    });
                    $("#edit_close").click();
                    init_load_roles(0,parseInt($("#pageNumberSelect").val()));
                }else {
                    dialog.render({
                        lang:"submit_failed",
                    });
                }
                locale.render({element: "#init_body"});
            }, this);
        }
    }

    //清除验证提示
    function clear_validationInfo() {
        $(".formError.inline").remove();
    }

    //阻断keydown事件
    $('body').keypress(function(event) {
        if (event.keyCode === 10 || event.keyCode === 13)
            event.preventDefault();
    });

    //页面功能权限过滤
    $(document).ready(function() {
        permissionFilter_pageFunc();
        require(['rolesManagementService'], function(rolesManagementService) {
            // 页面加载时初始化
            $("#page-footer").load("admin/pagination.html", function() {
                init_load_roles(0,parseInt($("#pageNumberSelect").val()));
            });
        });
        locale.render({element: "#init_body"});
    });
</script>
