
<div class="row">
    <div class="col-sm-12" style="padding-bottom: 10px;">
        <form class="form-inline" id="performanceSearchForm">
            <!--左侧-->
            <div class="form-group has-feedback">
                <input type="text" class="form-control form-control-left input-sm" id="statisticsDate" style="background-color: white;cursor: pointer;" readonly="readonly">
                <span class="glyphicon glyphicon-calendar form-control-feedback" style="left: 0;"></span>
            </div>
            <div class="form-group" style="padding: 5px 0px;">
                <span>
                     <label lang="text:site"></label>
                     <input type="text" id="statisticsSite" class="form-control input-sm validate[custom[stopSpecialCharacters]]" lang="placeholder:site">
                </span>
            </div>
            <div class="form-group just-btn">
                <button type="button" class="btn btn-default btn-sm"
                        onclick="loadReportData()" data-toggle="tooltip"
                        lang="title:query"><span
                        class="glyphicon glyphicon-search"></span>
                </button>
            </div>
        </form>
    </div>
</div>
<div id="faultCauseReport" class="row no-margin">
    <div class="box">
        <div class="box-header with-border">
            <h3 class="box-title" lang="text:"></h3>
            <div class="box-tools pull-right">
                <button class="btn btn-box-tool" data-widget="collapse">
                    <i class="glyphicon glyphicon-minus"></i>
                </button>
            </div>
        </div>
        <div class="box-body">
            <div class="chart" style="height:400px;width:100%;" id="causeChart">
                
            </div>
        </div><!-- /.box-body -->
    </div><!-- /.box -->
</div>

<script>
    function loadReportData() {
        var sitename=$.trim($("#statisticsSite").val());
        var statisticsDate=($("#statisticsDate").val()).split("-");
        //获取atm故障统计
        var params={};
        params.start = new Date(statisticsDate[0] + " 00:00:00").getTime();
        params.end = new Date(statisticsDate[1] + " 23:59:59").getTime();
        if (sitename !== "") {
            sitename = sitename.match(pattern);
            params.site_name = sitename;
        }
        getDeviceFailureData(params,true, function (data) {
            draw_getDeviceFailureData(data);
        },this);
    }

    function draw_getDeviceFailureData(data) {
        var barOptionstr = JSON.stringify(barOption);
        var causeOption = $.parseJSON(barOptionstr);
        var causes = [];
        var counts = [];
        var seriesData = [];
        var legendData = [locale.get("count")];
        for (var i = 0; i < data.length; i++) {
            causes.push(data[i].cause);
            counts.push(data[i].count);
        }
        seriesData.push({
            name: locale.get("count"),
            type: 'bar',
            data: counts
        });
        causeOption.legend.data = legendData;
        causeOption.series  = seriesData;
        causeOption.xAxis = [{
            type: 'category',
            data: causes
        }];
        causeOption.yAxis = [{
            type: 'value'
        }];
        if(counts.length>0 && causes.length>0){
            _drawChart("causeChart",causeOption);
        }else{
            $("#causeChart").empty();
            $("#causeChart").append("<div style='text-align: center;'><h2>" + locale.get('no_data') + "</h2></div>");
            locale.render({ element: "#init_body" });
        }
    }

    function _drawChart(id,chartOption) {
        require(
            [
                'echarts',
                'echarts/chart/line',
                'echarts/chart/bar',
                'echarts/chart/pie'
            ],
            function(ec) {

                var myChart = ec.init(document.getElementById(id));
                //图表显示提示信息
                myChart.showLoading({
                    text: locale.get("the_chart_data_are_trying_to_load"),
                    x: "center",
                    y: "center",
                    textStyle: {
                        color: "white",
                        fontSize: 14
                    },
                    effect: "spin"
                });
                myChart.setOption(chartOption,true);
                chartIds[id] = myChart;
                myChart.hideLoading();
            }
        );
        locale.render({element: "#init_body"});
    }

    function init_start() {
        //初始化日期
        $('#statisticsDate').daterangepicker(
            {
                startDate: moment().subtract(6, 'days'),
                endDate: moment(),
                maxDate: moment(),
                showDropdowns: false,
                showWeekNumbers: false,
                separator: '-',
                locale: {
                    format: 'YYYY/MM/DD',
                    separator: '-',
                    applyLabel: locale.get("apply"),
                    cancelLabel: locale.get("cancel")
                }
            },
            function (start, end) {
                $('#statisticsDate').val(start.format('YYYY/MM/DD') + '-' + end.format('YYYY/MM/DD'));
            }
        );

        //初始化显示
        require(['reportStatisticsService'], function() {
            loadReportData();
            locale.render({element: "#init_body"});
        });

    }
</script>